const t={WALL_R:0,WALL_L:1,WALL_T:2,WALL_B:3,WALL_RT:4,WALL_LT:5,WALL_BR:6,WALL_BL:7,FLOOR:8,AIR:9,HERO:10,TABLE:11,CHAIR_T:12,CHAIR_B:13,PC:14,PC_B:15,BOX:16},h={CHAIR:0,DESK:1,PC:2,VEND:3};function n(t,i,e){this.numberFrames=t,this.frameDuration=i,this.loop=e,this.timeElapsed=0,this.currentFrame=0,this.pauseAnimation=!1,this.getKeyFrame=function(t){this.timeElapsed+=t,this.currentFrame=Math.floor(this.timeElapsed/this.frameDuration),this.currentFrame=this.currentFrame%this.numberFrames}}function o(i,e,s,h,n,o,a,r){this.entity=new b(i,i,e,s,h,n,"BLACK",4,hitboxOffsetX=0,hitboxOffsetY=0,image="atlas.png"),this.entity.setType(),this.column=a,this.row=r,this.active=!0,this.update=function(){this.entity.update()},this.tick=function(t){},this.change=function(){switch(this.entity.type>=Object.values(t).length&&(this.entity.type=0),this.entity.type){case t.WALL_R:this.entity.type=t.WALL_R,this.entity.isSolid=!0;break;case t.WALL_L:this.entity.type=t.WALL_L,this.entity.isSolid=!0;break;case t.WALL_T:this.entity.type=t.WALL_T,this.entity.isSolid=!0;break;case t.WALL_B:this.entity.type=t.WALL_B,this.entity.isSolid=!0;break;case t.WALL_RT:this.entity.type=t.WALL_RT,this.entity.isSolid=!0;break;case t.WALL_LT:this.entity.type=t.WALL_LT,this.entity.isSolid=!0;break;case t.WALL_BR:this.entity.type=t.WALL_BR,this.entity.isSolid=!0;break;case t.WALL_BL:this.entity.type=t.WALL_BL,this.entity.isSolid=!0;break;case t.FLOOR:this.entity.type=t.FLOOR,this.entity.isSolid=!1;break;case t.TABLE:this.entity.type=t.TABLE,this.entity.isSolid=!0;break;case t.CHAIR_B:this.entity.type=t.CHAIR_B,this.entity.isSolid=!1;break;case t.CHAIR_T:this.entity.type=t.CHAIR_T,this.entity.isSolid=!1;break;case t.PC:this.entity.type=t.PC,this.entity.isSolid=!1}this.entity.setType()},this.isTable=function(){return this.entity.type==t.TABLE},this.isChairB=function(){return this.entity.type==t.CHAIR_B},this.isChairT=function(){return this.entity.type==t.CHAIR_T}}function a(t,i,e,s){this.x=t,this.y=i,this.w=e,this.h=s}function r(t,i){return i.tiles[t]}function l(){for(var t="#",i=0;i<6;i++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t}function c(t){return new a(t.x,t.y,t.w,t.h)}function u(t,i,e){return new a(t.x,t.y,i,e)}function d(t,i,e,s,h,n,o,a){return t<h+o&&t+e>h&&i<n+a&&i+s>n}function d(t,i){return t.x<i.x+i.w&&t.x+t.w>i.x&&t.y<i.y+i.h&&t.y+t.h>i.y}function f(t,i){this.x=t,this.y=i,this.set=function(t,i){this.x=t,this.y=i}}function L(t){Y.context.fillStyle="#FFF";for(let i=2e3;i--;)x=(1e9*Math.sin(i)-t/2e3*(i+1e3)/50)%(Y.canvas.width+9)-9,y=9*i%Y.canvas.height,s=i%5,Y.context.fillRect(x,y,s,s)}function p(t,i){return Object.values(t)[i]}function m(t){return Object.keys(t)}function g(t){return m(t).map(function(i){return t[i]})}function A(t,i){return t[m(t).filter(function(t){return i===t}).pop()||""]}function v(t,i){return m(t).filter(function(e){return t[e]===i}).pop()||null}function w(e,s,h){this.tiles=[],this.backTiles=[],this.startX=0,this.startY=0,this.canvasHalfW=e/2,this.canvasHalfH=s/2,this.levels=[],this.active=!1,this.complete=!1,this.maxLevels;this.draw=function(t){for(i=0;i<this.backTiles.length;i++){this.backTiles[i].update()}for(i=0;i<this.tiles.length;i++){this.tiles[i].update()}},this.tick=function(t){for(i=0;i<this.tiles.length;i++){this.tiles[i].tick(t)}},this.reset=function(i,e){var s=null!=i?i.currentLevel:0;this.tiles=[],this.backTiles=[],this.levels[s];for(row=0;row<13;row++)for(col=0;col<19;col++){var h;xx=16*col*e,yy=16*row*e;var n=t.WALL;n=0==row||0==col||12==row||18==col?t.AIR:1==row&&1==col?t.WALL_RT:1==row&&col>1&&col<17?t.WALL_T:1==row&&17==col?t.WALL_LT:11==row&&17==col?t.WALL_BR:11==row&&1==col?t.WALL_BL:11==row&&col>1&&col<17?t.WALL_B:17==col?t.WALL_R:1==col?t.WALL_L:t.FLOOR,h=new o(16,xx,yy,0,n,!1,col,row),this.tiles.push(h)}}}function b(i,e,s,n,o,r,l,c,u=0,y=0,d="",f=!1){this.scale=c,this.type=r,this.width=i,this.height=e,this.mhWidth=i/-2,this.mhHeight=e/-2,this.mhWidthScaled=i/-2*c,this.mhHeightScaled=e/-2*c,this.hWidth=i/2,this.hHeight=e/2,this.yOffset=0,this.angle=o,this.x=s,this.y=n,this.active=!0,this.colour=l,this.image=new Image,this.image.src=d,this.animated=!1,this.anination=null,this.hitboxOffsetX=u,this.hitboxOffsetY=y,this.alpha=1,this.currentTile=0,this.collisionArray=[],this.isSolid=!1,this.isButton=f,this.chairs=0,this.hasPC_B=!1,this.hasPC_T=!1,this.sx=0,this.sy=0,this.setHitbox=function(){this.hitbox=new a(0,0,0,0),this.isButton?(this.hitbox.w=2*this.width,this.hitbox.h=2*this.height):(this.hitbox.w=this.width*this.scale-this.hitboxOffsetX*this.scale,this.hitbox.h=this.height*this.scale-this.hitboxOffsetX*this.scale)},this.setHitbox(),this.updateHitbox=function(){this.isButton?(this.hitbox.x=this.x-this.width,this.hitbox.y=this.y-this.height):(this.hitbox.x=this.x+this.hitboxOffsetX*this.scale/2,this.hitbox.y=this.y+this.hitboxOffsetX*this.scale/2)},this.update=function(i){this.updateHitbox(),this.active&&(ctx=Y.context,ctx.save(),ctx.translate(this.x,this.y),ctx.globalAlpha=this.alpha,this.animated?(this.animation.pauseAnimation||this.animation.getKeyFrame(i),ctx.drawImage(this.image,this.width*this.animation.currentFrame,0,this.width,this.height,0,0,this.width*this.scale,this.height*this.scale)):null==this.image||this.isButton?(ctx.fillStyle=this.colour,ctx.fillRect(.5*this.mhWidth*this.scale,.5*this.mhHeight*this.scale,.5*this.width*this.scale,.5*this.height*this.scale)):ctx.drawImage(this.image,this.sx,this.sy,this.width,this.height,this.hWidth,this.hHeight,this.width*this.scale,this.height*this.scale),this.isButton&&(this.type==h.CHAIR?ctx.drawImage(this.image,84,16,8,8,-16,-16,32,32):this.type==h.DESK?ctx.drawImage(this.image,64,16,16,16,-16,-16,32,32):this.type==h.PC&&ctx.drawImage(this.image,115,17,10,13,-16,-16,32,32)),this.type==t.TABLE&&(ctx.globalAlpha=1,this.hasPC_B?(ctx.translate(0,-30),ctx.drawImage(this.image,112,16,this.width,this.height,this.hWidth,this.hHeight,this.width*this.scale,this.height*this.scale)):this.hasPC_T&&(ctx.translate(0,-20),ctx.drawImage(this.image,128,16,this.width,this.height,this.hWidth,this.hHeight,this.width*this.scale,this.height*this.scale))),ctx.restore())},this.flipMonitors=function(){(this.hasPC_B||this.hasPC_T)&&(this.hasPC_B=!this.hasPC_B,this.hasPC_T=!this.hasPC_T)},this.isTable=function(){return this.type==t.TABLE},this.isChairB=function(){return this.type==t.CHAIR_B},this.isChairT=function(){return this.type==t.CHAIR_T},this.setType=function(){switch(this.alpha=1,this.sy=0,this.sx=0,this.type){case t.WALL_R:this.sx=80,this.isSolid=!0;break;case t.WALL_RT:this.sx=128,this.isSolid=!0;break;case t.WALL_LT:this.sx=16,this.sy=16,this.isSolid=!0;break;case t.WALL_L:this.sx=64,this.isSolid=!0;break;case t.WALL_T:this.sy=16,this.isSolid=!0;break;case t.WALL_B:this.sx=112,this.isSolid=!0;break;case t.WALL_BR:this.sx=32,this.sy=16,this.isSolid=!0;break;case t.WALL_BL:this.sx=48,this.sy=16,this.isSolid=!0;break;case t.FLOOR:this.sx=48,this.alpha=.4,this.isSolid=!1;break;case t.AIR:this.sx=144,this.isSolid=!1;break;case t.TABLE:this.sx=64,this.sy=16,this.isSolid=!0;break;case t.CHAIR_T:this.sx=80,this.sy=16,this.isSolid=!1;break;case t.CHAIR_B:this.sx=96,this.sy=16,this.isSolid=!1;break;case t.PC:this.sx=112,this.sy=16,this.isSolid=!1}}}function k(){xOffset=5,yOffset=5,this.scale=4,this.hero=new b(16,16,C/2,I/2,0,t.HERO,"red",this.scale,xOffset,yOffset),this.hero.image.src="atlas.png",this.hero.sx=16,this.entities=[],this.speed=5,this.level=new w(C,I,0),this.hero.currentLevel=0,this.level.reset(this.hero,this.scale),this.menu=new Build(this.scale),this.update=function(t,i){for(b in R=navigator.getGamepads(),N()&&(this.hero.x-=this.getMoveAmount(-this.speed,0)),z()&&(this.hero.x+=this.getMoveAmount(this.speed,0)),V()&&(this.hero.y-=this.getMoveAmount(0,-this.speed)),q()&&(this.hero.y+=this.getMoveAmount(0,this.speed)),J(),heroRow=Math.floor((this.hero.y-this.hero.mhHeightScaled)/64),heroCol=Math.floor((this.hero.x-this.hero.mhWidthScaled)/64),heroTileIndex=heroCol+19*heroRow,null!=this.currentTile&&(this.prevTile=this.currentTile),this.currentTile=this.level.tiles[heroTileIndex],this.currentTile!=this.prevTile&&(this.hero.collisionArray=[],heroTileIndex&&this.hero.collisionArray.push(this.level.tiles[heroTileIndex-1]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex+1]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex+18]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex+19]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex+20]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex-18]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex-19]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex-20])),L(i),this.level.tick(this.hero),this.level.draw(this.hero),this.entities)e=this.entities[b],e.update(t);D&&(D=K.menu.tick()),this.menu.processBuilding(D,this.level),D=!1,this.hero.update(t),this.menu.update(),Y.canvas.style.cursor="none";let s=M.x,h=M.y;Y.context.globalCompositeOperation="difference",Y.context.fillStyle="WHITE",Y.context.fillRect(s-2,h-15,4,30),Y.context.fillRect(s-15,h-2,30,4),Y.context.globalCompositeOperation="source-over"},this.getMoveAmount=function(t,i){rec=c(this.hero.hitbox),rec.x+=t,rec.y+=i,amount=0;for(var e=1;e<this.speed;e++){canMove=!0;for(var s=0;s<this.hero.collisionArray.length;s++)if(tile=this.hero.collisionArray[s],tile.entity.isSolid&&d(tile.entity.hitbox,rec)){canMove=!1;break}canMove&&amount++}return amount}}var T,_,W,B=!1,R=[],C=1216,I=832,S=!1,H=0,O=Date.now(),E=Date.now(),F=0,M=new f(0,0),P=new f(0,0),D=!1,G=1.346,X=1.38,K=new k;function startGame(){Y.start()}var Y={canvas:document.createElement("canvas"),start:function(){this.canvas.width=C,this.canvas.height=I,this.context=this.canvas.getContext("2d"),this.context.scale(1,1),this.context.mozImageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.context.imageSmoothingEnabled=!1,this.canvas.classList.add("screen"),document.body.insertBefore(this.canvas,document.body.childNodes[6]),this.frameNo=0,this.interval=setInterval(j,20),window.addEventListener("keydown",function(t){t.preventDefault(),Y.keys=Y.keys||[],Y.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("keyup",function(t){Y.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("mousedown",function(t){t.preventDefault(),Y.keys=Y.keys||[],Y.keys[t.button]=!0}),window.addEventListener("mouseup",function(t){t.preventDefault(),Y.keys=Y.keys||[],Y.keys[t.button]=!1,P.set(M.x,M.y),_=Math.floor(P.y/64),W=Math.floor(P.x/64),T=W+19*_,D=!0}),window.addEventListener("mousemove",function(t){t.preventDefault();var i=Y.canvas.getBoundingClientRect();M.set((t.clientX-i.left)*G,(t.clientY-i.top)*X)}),this.canvas.oncontextmenu=function(t){t.preventDefault()},window.addEventListener("gamepadconnected",function(t){var i=navigator.getGamepads()[t.gamepad.index];console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",i.index,i.id,i.buttons.length,i.axes.length)})},stop:function(){clearInterval(this.interval)},clear:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}};function j(){O=E,E=Date.now(),F+=H=E-O,navigator.getGamepads?navigator.getGamepads():!navigator.webkitGetGamepads||navigator.webkitGetGamepads,S?Y.clear():(Y.clear(),K.update(H/1e3,F))}function N(){return Y.keys&&(Y.keys[Q]||Y.keys[it])}function z(){return Y.keys&&(Y.keys[U]||Y.keys[st])}function V(){return Y.keys&&(Y.keys[Z]||Y.keys[tt])}function q(){return Y.keys&&(Y.keys[$]||Y.keys[et])}function J(){return Y.keys&&Y.keys[ot]}var Q=37,U=39,Z=38,$=40,tt=87,it=65,et=83,st=68,ht=0,nt=2,ot=32,at=49,rt=50,lt=51,ct=52;