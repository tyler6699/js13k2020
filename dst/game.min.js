var e,h=!1,n=!1,o={songData:[{i:[2,70,128,0,2,75,128,3,0,0,27,8,65,0,0,0,0,39,3,1,2,133,79,2,32,128,4,29,2],p:[,,1,1,1,3,,2,1,1],c:[{n:[127,,127,,127,115,127,112,122,,122,,122,110,122,115,124,,124,,124,112,124,112,120,,120,,120,108,120,112,139,,139,,139,,139,,134,,134,,134,,134,,136,,136,,136,,136,,132,,132,,132,,132,,143,,143,,143,,143,,138,,138,,138,,138,,139,,139,,139,,139,,136,,136,,136,,136,,146,,146,,146,,146,,141,,141,,141,,141,,143,,143,,143,,143,,139,,139,,139,,139],f:[13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,47,,,,68,,,,51,,,,67,,,,52,,,,67,,,,52,,,,65]},{n:[127,,127,,127,115,127,112,122,,122,,122,110,122,115,124,,124,,124,112,124,112,120,,120,,120,108,120,112,,,,,,,,,,,,,,,,,,,,,,,,,,,,,132,138,136,144],f:[13,,,,,,,,,,,,,,,,,,,,,,,,13,,,,,,,,53,,,,,,,,,,,,,,,,,,,,,,,,67]},{n:[127,,127,,127,115,127,112,122,,122,,122,110,122,115,124,,124,,124,112,124,112,120,,120,,120,108,120,112,139,,139,,139,,139,,134,,134,,134,,134,,136,,136,,136,,136,,132,,,,,,,,143,,143,,143,,143,,138,,138,,138,,138,,139,,139,,139,,139,,136,,,,,,,,146,,146,,146,,146,,141,,141,,141,,141,,143,,143,,143,,143,,139],f:[13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,13,,13,,,,47,,,,67,,,,51,,,,69,,,,48,,,,68,,,,48,,67,,44]}]},{i:[3,219,147,0,2,116,128,6,0,0,6,11,71,0,0,0,0,68,3,1,2,48,125,11,43,77,6,25,6],p:[1,1,2,2,2,2,2,2,2,2],c:[{n:[127,,127,,127,115,127,112,122,,122,,122,110,122,115,124,,124,,124,112,124,112,120,,120,,120,108,120,112],f:[13,,13,,13,,,,13,,13,,13,,,,13,,13,,13,,,,13,,13,,13,,,,97,,76,,59,,,,97,,76,,57,,,,97,,76,,60,,,,97,,75,,56]},{n:[127,,127,,127,115,127,112,122,,122,,122,110,122,115,124,,124,,124,112,124,112,120,,120,,120,108,120,112,146,151,155,146,151,155,146,151,146,150,153,146,150,153,146,150,148,151,155,148,151,155,148,151,148,151,156,148,151,156,148,151],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,71]}]},{i:[2,51,128,0,2,45,128,2,0,0,53,22,158,0,0,0,0,93,7,1,3,18,39,0,32,48,5,61,5],p:[1,1,1,1,1,1,1,1,1,1,1,1,2],c:[{n:[127,,,,,,,,122,,,,,,,,124,,,,,,,,120,,,,,,,,134,,,,,,,,134,,,,,,,,136,,,,,,,,136,,,,,,,,139,,,,,,,,138,,,,,,,,139,,,,,,,,139,,,,,,,,143,,,,,,,,141,,,,,,,,143,,,,,,,,144],f:[11,,,,,,,,,,,,,,,,,,,,,,,,11,,,,,,,,36,,,,,,,,,,,,,,,,,,,,,,,,53]},{n:[127,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,134,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,139,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,143],f:[11,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,91]}]},{i:[1,192,128,0,1,192,128,1,0,0,12,19,50,0,0,0,0,152,5,1,3,37,155,48,57,108,3,51,3],p:[,,,,1,1,,,1,1],c:[{n:[134,139,143,134,139,143,134,139,134,138,141,134,138,141,134,138,136,139,143,136,139,143,136,139,136,139,144,136,139,144,136,139,127,,,,,,,,122,,,,,,,,112,,,,,,,,120],f:[]}]},{i:[3,222,128,0,0,120,116,0,0,19,8,3,31,0,0,0,0,166,4,1,2,24,81,17,99,80,5,119,6],p:[,,,,,,1,2,1,2,3,2,4],c:[{n:[163,,,,,,,,158,,,,,,,,160,,,,,,,,156,,,,,,,,158,,,,151,,163,,,,,,158,,170,,,,,,148,,160,,,,,,156,,168],f:[25,13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,99,31]},{n:[163,,,,,,,,158,,,,,,,,160,,,,,,,,168,,,,,,,,158,,,,151,,163,,,,,,158,,170,,,,,,148,,160,,,,,,168,,180],f:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,25,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,52]},{n:[163,,,,,,,,158,,,,,,,,160,,,,,,,,156,,,,,,,,158,,,,151,,163,,,,,,158,,170,,,,,,148,,160,,,,,,156,,168],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,108]},{n:[139,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,151],f:[]}]},{i:[3,162,110,64,1,95,128,0,64,108,0,8,160,0,0,0,0,79,7,1,3,89,154,2,32,40,5,115,4],p:[,,,,,1,,,,1],c:[{n:[,,,,,,,,,,,,,,,,,,,,,,,,147],f:[]}]},{i:[0,0,140,0,0,0,140,0,0,255,158,158,158,0,0,0,0,51,2,1,2,58,239,0,97,88,1,157,2],p:[,,,,,,1,,1],c:[{n:[135],f:[]}]},{i:[0,222,128,0,0,234,128,0,64,0,196,11,236,0,0,0,0,61,8,0,2,5,140,74,57,100,5,92,7],p:[,,,,,,,,,,1],c:[{n:[139,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,127],f:[]}]}],rowLen:10669,patternLen:32,endPattern:12,numChannels:8},r=function(){var t,i,e,s,h,n=function(t){return Math.sin(6.283184*t)},o=function(t){return.003959503758*Math.pow(2,(t-128)/12)},r=function(t,i,e){var s,h,n,r,l,a,u,x=c[t.i[0]],f=t.i[1],p=t.i[3],d=c[t.i[4]],y=t.i[5],T=t.i[8],w=t.i[9],v=t.i[10]*t.i[10]*4,g=t.i[11]*t.i[11]*4,m=t.i[12]*t.i[12]*4,A=1/m,b=t.i[13],E=e*Math.pow(2,2-t.i[14]),L=new Int32Array(v+g+m),R=0,I=0;for(s=0,h=0;s<v+g+m;s++,h++)h>=0&&(h-=E,a=o(i+(15&(b=b>>8|(255&b)<<4))+t.i[2]-128),u=o(i+(15&b)+t.i[6]-128)*(1+8e-4*t.i[7])),n=1,s<v?n=s/v:s>=v+g&&(n-=(s-v-g)*A),r=a,p&&(r*=n*n),l=x(R+=r)*f,r=u,T&&(r*=n*n),l+=d(I+=r)*y,w&&(l+=(2*Math.random()-1)*w),L[s]=80*l*n|0;return L},c=[n,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var i=t%1*4;return i<2?i-1:3-i}];this.init=function(n){t=n,i=n.endPattern,e=0,s=n.rowLen*n.patternLen*(i+1)*2,h=new Int32Array(s)},this.generate=function(){var o,l,a,u,x,f,p,d,y,T,w,v,g,m,A=new Int32Array(s),b=t.songData[e],E=t.rowLen,L=t.patternLen,R=0,I=0,O=!1,C=[];for(a=0;a<=i;++a)for(p=b.p[a],u=0;u<L;++u){var k=p?b.c[p-1].f[u]:0;k&&(b.i[k-1]=b.c[p-1].f[u+L]||0,k<16&&(C=[]));var P=c[b.i[15]],S=b.i[16]/512,M=Math.pow(2,b.i[17]-9)/E,H=b.i[18],W=b.i[19],B=43.23529*b.i[20]*3.141592/44100,D=1-b.i[21]/255,N=1e-5*b.i[22],_=b.i[23]/32,U=b.i[24]/512,G=6.283184*Math.pow(2,b.i[25]-9)/E,X=b.i[26]/255,Y=b.i[27]*E&-2;for(w=(a*L+u)*E,x=0;x<4;++x)if(f=p?b.c[p-1].n[u+x*L]:0){C[f]||(C[f]=r(b,f,E));var F=C[f];for(l=0,o=2*w;l<F.length;l++,o+=2)A[o]+=F[l]}for(l=0;l<E;l++)(T=A[d=2*(w+l)])||O?(v=B,H&&(v*=P(M*d)*S+.5),I+=(v=1.5*Math.sin(v))*(g=D*(T-I)-(R+=v*I)),T=3==W?I:1==W?g:R,N&&(T=(T*=N)<1?T>-1?n(.25*T):-1:1,T/=N),O=(T*=_)*T>1e-5,m=T*(1-(y=Math.sin(G*d)*U+.5)),T*=y):m=0,d>=Y&&(m+=A[d-Y+1]*X,T+=A[d-Y]*X),A[d]=0|m,A[d+1]=0|T,h[d]+=0|m,h[d+1]+=0|T}return++e/t.numChannels},this.createWave=function(){var t=44+2*s-8,i=t-36,e=new Uint8Array(44+2*s);e.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&i,i>>8&255,i>>16&255,i>>24&255]);for(var n=0,o=44;n<s;++n){var r=h[n];r=r<-32767?-32767:r>32767?32767:r,e[o++]=255&r,e[o++]=r>>8&255}return e},this.getData=function(t,i){for(var e=2*Math.floor(44100*t),s=new Array(i),n=0;n<2*i;n+=1){var o=e+n;s[n]=t>0&&o<h.length?h[o]/32768:0}return s}};function c(){var t=new r;t.init(o),setInterval(function(){if(!h&&(h=t.generate()>=1)){var i=t.createWave();(e=document.createElement("audio")).src=URL.createObjectURL(new Blob([i],{type:"audio/wav"})),n=!0}},0)}const l={WALL_R:0,WALL_L:1,WALL_T:2,WALL_B:3,WALL_RT:4,WALL_LT:5,WALL_BR:6,WALL_BL:7,FLOOR:8,AIR:9,HERO:10,TABLE:11,CHAIR_T:12,CHAIR_B:13,PC:14,PC_B:15,BOX:16,SERVER:17,PERSON:18,VEND:19,AUTO:20},a={GUN:0,DESK:1,CHAIR:2,PC:3,SERVER:4,VEND:5,AUTO:6,UP:7};function u(t,i,e,s,h,n,o,r){this.entity=new O(t,t,i,e,s,h,"",4,hitboxOffsetX=0,hitboxOffsetY=0),this.entity.setType(),this.column=o,this.row=r,this.active=!0,this.update=function(t){this.entity.update(t),null!=this.person()&&this.entity.person.tick()},this.change=function(){this.entity.type>=Object.values(l).length&&(this.entity.type=0),this.entity.setType()},this.isFloor=function(){return this.entity.isFloor()},this.person=function(){return this.entity.person}}function f(t){st.hero.showTextY=-15,st.hero.showTextTime=TEXTTIME/2,st.hero.showText=t}function p(t,i,e,s){this.x=t,this.y=i,this.w=e,this.h=s}function d(t,i){return i.tiles[t]}function T(t,i){return Math.floor(Math.random()*(i-t+1)+t)}function w(){for(var t="#",i=0;i<6;i++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t}function v(t){return new p(t.x,t.y,t.w,t.h)}function g(t,i,e){return new p(t.x,t.y,i,e)}function m(t,i,e,s,h,n,o,r){return t<h+o&&t+e>h&&i<n+r&&i+s>n}function A(t,i){return t.x<i.x+i.w&&t.x+t.w>i.x&&t.y<i.y+i.h&&t.y+t.h>i.y}function E(t,i){this.x=t,this.y=i,this.set=function(t,i){this.x=t,this.y=i}}function L(t){ot.context.fillStyle="#FFF";for(let i=2e3;i--;)x=(1e9*Math.sin(i)-t/2e3*(i+1e3)/50)%(ot.canvas.width+9)-9,y=9*i%ot.canvas.height,s=i%5,ot.context.fillRect(x,y,s,s)}function R(t,i){return Object.values(t)[i]}function I(t,e,s){this.tiles=[],this.backTiles=[],this.startX=0,this.startY=0,this.canvasHalfW=t/2,this.canvasHalfH=e/2,this.levels=[],this.active=!1,this.complete=!1,this.maxLevels;this.draw=function(t,e){for(i=0;i<this.backTiles.length;i++){this.backTiles[i].update(e)}for(i=0;i<this.tiles.length;i++){this.tiles[i].update(e)}},this.reset=function(t,i){var e=null!=t?t.currentLevel:0;this.tiles=[],this.backTiles=[],this.levels[e];for(row=0;row<13;row++)for(col=0;col<19;col++){var s;xx=16*col*i,yy=16*row*i;var h=l.WALL;h=0==row||0==col||12==row||18==col?l.AIR:1==row&&1==col?l.WALL_RT:1==row&&col>1&&col<17?l.WALL_T:1==row&&17==col?l.WALL_LT:11==row&&17==col?l.WALL_BR:11==row&&1==col?l.WALL_BL:11==row&&col>1&&col<17?l.WALL_B:17==col?l.WALL_R:1==col?l.WALL_L:l.FLOOR,s=new u(16,xx,yy,0,h,!1,col,row),this.tiles.push(s)}}}function O(t,i,e,s,h,n,o,r,c=0,a=0,u=!1){this.scale=r,this.type=n,this.width=t,this.height=i,this.mhWidth=t/-2,this.mhHeight=i/-2,this.mhWidthScaled=t/-2*r,this.mhHeightScaled=i/-2*r,this.hWidth=t/2,this.hHeight=i/2,this.yOffset=0,this.yDrawOffset=0,this.angle=h,this.x=e,this.y=s,this.active=!0,this.colour=o,this.image=et,this.animated=!1,this.anination=null,this.hitboxOffsetX=c,this.hitboxOffsetY=a,this.alpha=1,this.currentTile=0,this.collisionArray=[],this.isSolid=!1,this.isButton=u,this.drawTile=!1,this.pc=null,this.person=null,this.gun=null,this.ammo=5,this.time=0,this.showText="",this.showTextTime=0,this.showTextY=0,this.currentGift=0,this.shootTime=0,this.hover=!1,this.hoverText="",this.hoverText2="",this.sx=0,this.sy=0,this.setHitbox=function(){this.hitbox=new p(0,0,0,0),this.sensor=new p(0,0,0,0),this.isButton&&(this.hitbox.w=2*this.width,this.hitbox.h=2*this.height)},this.setHitbox(),this.updateHitbox=function(){this.isButton?(this.hitbox.x=this.x-this.width,this.hitbox.y=this.y-this.height):(this.hitbox.x=this.x+this.hitboxOffsetX*this.scale/2,this.hitbox.y=this.y+this.hitboxOffsetX*this.scale/2,this.hitbox.w=this.width*this.scale-this.hitboxOffsetX*this.scale,this.hitbox.h=this.height*this.scale-this.hitboxOffsetY*this.scale,this.sensor.x=this.x-5,this.sensor.y=this.y-5,this.sensor.w=this.width*this.scale+10,this.sensor.h=this.height*this.scale+10)},this.isFloor=function(){return this.type==l.FLOOR},this.update=function(t){this.updateHitbox(),this.active&&(ctx=ot.context,ctx.save(),ctx.translate(this.x,this.y),this.drawTile&&(ctx.globalAlpha=.4,ctx.drawImage(this.image,48,0,16,16,8,8,64,64)),ctx.globalAlpha=this.alpha,null==this.image||this.isButton?(ctx.fillStyle=this.colour,ctx.fillRect(.5*this.mhWidth*this.scale,.5*this.mhHeight*this.scale,.5*this.width*this.scale,.5*this.height*this.scale)):ctx.drawImage(this.image,this.sx,this.sy,this.width,this.height,this.hWidth,this.hHeight+this.yDrawOffset,this.width*this.scale,this.height*this.scale),this.showTextTime>0?(this.showTextTime-=t,gradient=ctx.createLinearGradient(0,0,B,0),gradient.addColorStop("0","#"+Q),gradient.addColorStop(".1","#"+J),ctx.font="italic 25px Arial",ctx.fillStyle=gradient,ctx.fillText(this.showText,0,this.showTextY+10*this.showTextTime)):this.currentGift=0,this.isButton&&(by=32,bx=48,ctx.drawImage(this.image,bx,by,10,10,-16,-16,32,32),this.hover&&(ctx.globalAlpha=.8,ctx.fillStyle="#"+J,ctx.fillRect(-215,-50,167,100),ctx.fillStyle=this.colour,ctx.fillRect(-200,-32,165,64),ctx.globalAlpha=1,ctx.font="italic 25px Arial",ctx.fillStyle="#"+J,ctx.fillText(this.hoverText,-180,-5),ctx.fillText(this.hoverText2,-180,20))),ctx.restore())},this.isHero=function(){return this.type==l.HERO},this.setType=function(){switch(this.alpha=1,this.sy=0,this.sx=0,this.yDrawOffset=0,this.hitboxOffsetY=0,this.isSolid=!0,this.type){case l.WALL_R:this.sx=80;break;case l.WALL_RT:this.sx=128;break;case l.WALL_LT:this.sx=16,this.sy=16;break;case l.WALL_L:this.sx=64;break;case l.WALL_T:this.sy=16;break;case l.WALL_B:this.sx=112;break;case l.WALL_BR:this.sx=32,this.sy=16;break;case l.WALL_BL:this.sx=48,this.sy=16;break;case l.FLOOR:this.sx=48,this.alpha=.4,this.isSolid=!1,this.drawTile=!1;break;case l.AIR:this.sx=144,this.isSolid=!1}}}function C(){xOffset=5,yOffset=5,this.scale=4,this.hero=new O(16,16,B/2,D/2,0,l.HERO,"",this.scale,xOffset,yOffset),this.hero.sx=16,this.speed=5,this.level=new I(B,D,0),this.hero.currentLevel=0,this.level.reset(this.hero,this.scale),this.menu=new St(this.scale),this.update=function(t,i){ct()&&(this.hero.x-=this.getMoveAmount(-this.speed,0)),lt()&&(this.hero.x+=this.getMoveAmount(this.speed,0)),at()&&(this.hero.y-=this.getMoveAmount(0,-this.speed)),ut()&&(this.hero.y+=this.getMoveAmount(0,this.speed)),xt()&&(this.menu.curItm=a.GUN),ft()&&st.reset(),heroRow=Math.floor((this.hero.y-this.hero.mhHeightScaled)/64),heroCol=Math.floor((this.hero.x-this.hero.mhWidthScaled)/64),heroTileIndex=heroCol+19*heroRow,null!=this.currentTile&&(this.prevTile=this.currentTile),this.currentTile=this.level.tiles[heroTileIndex],this.currentTile!=this.prevTile&&(this.hero.collisionArray=[],heroTileIndex&&this.hero.collisionArray.push(this.level.tiles[heroTileIndex-1]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex+1]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex+18]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex+19]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex+20]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex-18]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex-19]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex-20])),this.getMoveAmount=function(t,i){rec=v(this.hero.hitbox),rec.x+=t,rec.y+=i,amount=0;for(var e=1;e<this.speed;e++){canMove=!0;for(var s=0;s<this.hero.collisionArray.length;s++)if(tile=this.hero.collisionArray[s],tile.entity.isSolid&&A(tile.entity.hitbox,rec)){canMove=!1;break}canMove&&amount++}return amount},L(i),this.level.draw(this.hero,t),gradient=ctx.createLinearGradient(0,0,B,0),gradient.addColorStop("0","#"+Q),gradient.addColorStop(".5","#"+J),ctx.fillStyle=gradient,ctx.font="italic 40px Arial",ctx.fillText("$: "+it,900,50),ctx.font="italic 30px Arial",ctx.fillText("GAMEOVER: "+z,30,810),ctx.fillText("WIN: "+tt,300,810),$=!1,this.hero.update(t),ot.canvas.style.cursor="none";let e=F.x,s=F.y;ot.context.globalCompositeOperation="difference",ot.context.fillStyle="WHITE",ot.context.fillRect(e-2,s-15,4,30),ot.context.fillRect(e-15,s-2,30,4),ot.context.globalCompositeOperation="source-over"},this.reset=function(){z=!1,tt=!1,this.hero=new O(16,16,B/2,D/2,0,l.HERO,"",this.scale,xOffset,yOffset),this.hero.sx=16,this.level=new I(B,D,0),this.level.reset(this.hero,this.scale)}}var k,P,S,M,H=!1,W=[],B=1216,D=832,N=!1,_=!0,U=0,G=Date.now(),X=Date.now(),Y=0,F=new E(0,0),V=new E(0,0),$=!1,K=1.346,q=1.38,z=!1,J="990099",Q="05f2db",Z=300,tt=!1,it=0,et=new Image;et.src="atlas.png";var st=new C;c();var ht=!1,nt=!1;function startGame(){ot.start()}var ot={canvas:document.createElement("canvas"),start:function(){this.canvas.width=B,this.canvas.height=D,this.context=this.canvas.getContext("2d"),this.context.scale(1,1),this.context.mozImageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.context.imageSmoothingEnabled=!1,this.canvas.classList.add("screen"),document.body.insertBefore(this.canvas,document.body.childNodes[6]),this.frameNo=0,this.interval=setInterval(rt,20),window.addEventListener("keydown",function(t){t.preventDefault(),ot.keys=ot.keys||[],ot.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("keyup",function(t){ot.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("mousedown",function(t){t.preventDefault(),ot.keys=ot.keys||[],ot.keys[t.button]=!0}),window.addEventListener("mouseup",function(t){t.preventDefault(),ot.keys=ot.keys||[],ot.keys[t.button]=!1,V.set(F.x,F.y),S=Math.floor(V.y/64),M=Math.floor(V.x/64),k=M+19*S,$=!0,ht||nt||(ht=!0)}),window.addEventListener("mousemove",function(t){t.preventDefault();var i=ot.canvas.getBoundingClientRect();F.set((t.clientX-i.left)*K,(t.clientY-i.top)*q),row=Math.floor(F.y/64),col=Math.floor(F.x/64),P=col+19*row}),this.canvas.oncontextmenu=function(t){t.preventDefault()}},stop:function(){clearInterval(this.interval)},clear:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}};function rt(){ht&&h&&(e.play(),e.loop=!0,ht=!1,N=!0),G=X,X=Date.now(),Y+=U=X-G,navigator.getGamepads?navigator.getGamepads():!navigator.webkitGetGamepads||navigator.webkitGetGamepads,N?(ot.clear(),st.update(U/1e3,Y)):(ot.clear(),ctx=ot.context,ctx.save(),ctx.globalAlpha=.3,ctx.fillStyle="#"+J,ctx.fillRect(75,75,1070,680),ctx.globalAlpha=1,ctx.font="italic 90px Arial",ctx.fillStyle="WHITE",ctx.fillText("-- CLICK TO START --",180,400),ctx.font="italic 50px Arial",ctx.fillText("JS13K 2020 - Theme 404",200,200),ctx.fillText("Get over 20 users, $10404",200,500),ctx.fillText("and a 100% rating to WIN.",200,600),ctx.fillText("@CarelessLabs",200,700),L(Y),ctx.restore())}function ct(){return ot.keys&&(ot.keys[pt]||ot.keys[vt])}function lt(){return ot.keys&&(ot.keys[dt]||ot.keys[mt])}function at(){return ot.keys&&(ot.keys[yt]||ot.keys[wt])}function ut(){return ot.keys&&(ot.keys[Tt]||ot.keys[gt])}function xt(){return ot.keys&&ot.keys[Et]}function ft(){return ot.keys&&ot.keys[Lt]}var pt=37,dt=39,yt=38,Tt=40,wt=87,vt=65,gt=83,mt=68,At=0,bt=2,Et=32,Lt=49,Rt=50,It=51,Ot=52;function Ct(t){this.scale=4,this.entity=new O(16,16,t.entity.x,t.entity.y,0,l.PERSON,"",this.scale,0,0),this.useTime=0,this.hasTarget=!1,this.progress=new Ht,this.parent=t.entity,this.tile=t,t.entity.type==l.CHAIR_B?(this.entity.sx=32,this.entity.sy=32):t.entity.type==l.CHAIR_T&&(this.entity.sx=16,this.entity.sy=32,this.entity.y-=40),this.tick=function(){this.entity.update(),this.progress.draw(this.entity.x,this.entity.y,this.entity),this.progress.tick(U),this.progress.fourfour||this.progress.delivered?(targets[this.tile.pc.id]=!1,this.parent.type==l.CHAIR_B?this.parent.showTextY=-25:this.parent.showTextY=-70,this.parent.showText=this.progress.fourfour?"Status: 404":"Status: 200",this.parent.showTextTime=TEXTTIME,this.progress.fourfour=!1,this.progress.delivered=!1):this.progress.percent>.75&&targets[this.tile.pc.id]&&(targets[this.tile.pc.id]=!1)}}function kt(t,i,e){PCID++,this.id=PCID,this.inUse=!1,this.direction=t,this.chair=i,this.chair.pc=this,this.tile=e,this.hitbox=new p(e.entity.x+30,e.entity.y+10,20,20),this.getPerson=function(){return this.chair.entity.person},this.rmPerson=function(){return this.chair.entity.person=null}}function Pt(t,i,e,s,h,n){this.entity=new O(t,i,e,s,0,n,h,4,hitboxOffsetX=0,hitboxOffsetY=0,!0),this.action=n,this.update=function(){this.entity.update()},this.tick=function(t){},this.processAction=function(){st.menu.curItm=this.action,this.action==a.UP&&(it>UPPRICE?DATAUPGRADE?SHOOTUPGRADE?AMMOGIFTUPGRADE?NEWPERSONCHANCE<100&&(it-=UPPRICE,NEWPERSONCHANCE+=10,st.hero.showTextY=-30,st.hero.showTextTime=2*TEXTTIME,st.hero.showText="Rating ++"):(AMMOGIFTUPGRADE=!0,AMMOGIFT=20,it-=UPPRICE,UPPRICE=0,st.hero.showTextY=-30,st.hero.showTextTime=2*TEXTTIME,st.hero.showText="MORE DATA PER SERVER"):(SHOOTUPGRADE=!0,it-=UPPRICE,UPPRICE=2e3,st.hero.showTextY=-30,st.hero.showTextTime=2*TEXTTIME,st.hero.showText="SHOOT SPEED +++",Z=1e3):(DATAUPGRADE=!0,it-=UPPRICE,UPPRICE=1500,st.hero.showTextY=-30,st.hero.showTextTime=2*TEXTTIME,st.hero.showText="AUTO DATA COLLECTION!"):(st.hero.showTextY=-30,st.hero.showTextTime=TEXTTIME,st.hero.showText="Not enough $$"))}}function St(e){for(this.scale=e,this.menu=new O(48,D,B-48,D/2,0,l.BOX,"#cc00cc",this.scale,0,0),this.menu.image=null,this.menu.alpha=.4,this.buttons=[],this.curItm=null,this.nButtons=10,this.canBuild=!1,this.hoverTile,i=0;i<this.nButtons;i++)this.buttons.push(new Pt(32,32,B-48,50+80*i,"#131a2d",R(a,i)));this.update=function(){for(this.menu.update(),i=0;i<this.nButtons;i++)b=this.buttons[i],b.update(),m(F.x,F.y,32,32,b.entity.x,b.entity.y,b.entity.width,b.entity.height)?b.entity.hover=!0:b.entity.hover=!1},this.checkBuild=function(){if(this.canBuild=!1,this.hoverTile=d(P,st.level),null!=this.hoverTile&&this.hoverTile.isFloor()||null!=this.hoverTile&&this.curItm==a.PC&&this.hoverTile.isTable())switch(this.curItm){case a.CHAIR:it>CHAIRPRICE&&(this.canBuild=!0)}},this.tick=function(){clickRec=new g(V,10,10);for(var t=0;t<this.buttons.length;t++)if(b=this.buttons[t],A(b.entity.hitbox,clickRec))return b.processAction(),!1;return!0},this.processBuilding=function(i,e,s){if(i&&(i=!1,ci=k,t=d(ci,e),null!=t)){switch(ta=d(ci-19,e),taa=d(ci-38,e),tb=d(ci+19,e),tbb=d(ci+38,e),this.curItm){case a.CHAIR:break;default:console.log("processBuilding NAN")}t.change()}}}function Mt(){this.customerList=[],this.pcs=[],this.time=0,this.eventTime=3,this.maxPChance=100,this.userCount=0,this.tick=function(t){if(this.time+=t,this.time>this.eventTime)for(this.time=0,i=0;i<this.pcs.length;i++)pc=this.pcs[i],null!=pc&&null==pc.chair.person()?T(0,100)<NEWPERSONCHANCE&&(pc.chair.entity.person=new Ct(pc.chair),this.userCount++):null!=pc.getPerson()&&(pc.getPerson().progress.reset(),pc.getPerson().progress.exit&&(pc.rmPerson(),this.userCount--,it-=EXITPENALTY,st.hero.showTextY=-5,st.hero.showTextTime=2*HEROTEXTTIME,st.hero.showText="- S"+EXITPENALTY,NEWPERSONCHANCE-=EXITCHANCEPEN,NEWPERSONCHANCE<=0&&(z=!0)))},this.draw=function(t){for(i=0;i<this.pcs.length;i++)pc=this.pcs[i],null!=pc&&null!=pc.chair.person()&&pc.chair.person().hasTarget&&pc.chair.person().entity.update(t)},this.removePC=function(t){this.pcs[t.id]=null,this.pcs=this.pcs.filter(function(t,i,e){return null!=t})},this.addPC=function(t){this.pcs[t.id]=t}}function Ht(){function t(t){return t>=1}this.percent=0,this.startAngle=1.5*Math.PI,this.endAngle=-.5*Math.PI+this.percent*Math.PI*2,this.colour1="silver",this.colour2=w(),this.resetChance=RESETCHANCE,this.happy=T(2,5),this.mHappy=!0,this.speed=8e3,this.minSpeed=8e3,this.maxSpeed=3e3,this.exit=!1,this.fourfour=!1,this.delivered=!1,this.waiting=!1,this.draw=function(i,e){ctx=ot.context,this.endAngle=-.5*Math.PI+this.percent*Math.PI*2,ctx.lineWidth=10,t(this.percent)?(this.waiting=!1,this.mHappy&&!this.delivered&&(this.fourfour=!0,this.happy--,this.mHappy=!1,0==this.happy&&(this.exit=!0))):(this.waiting=!0,this.mHappy=!0,ctx.beginPath(),ctx.arc(i,e,10,this.startAngle,this.endAngle),ctx.strokeStyle=this.colour1,ctx.stroke(),ctx.beginPath(),ctx.arc(i,e,10,this.endAngle,-.5*Math.PI),ctx.strokeStyle=this.colour2,ctx.stroke(),ctx.restore())},this.tick=function(i){t(this.percent)||(this.percent+=i/this.speed)},this.reset=function(){t(this.percent)&&this.resetChance>T(0,100)&&(this.percent=0,this.speed=T(this.maxSpeed,this.minSpeed))}}function Wt(){this.ammo=AMMOSTART,this.bullets=[],this.addBullets=function(t,i,e,s){this.ammo>0&&(this.bullets.push(new Bt(t,i,e,s)),this.ammo--)},this.drawBullets=function(t,e){for(i=0;i<this.bullets.length;i++){this.bullets[i].draw(t,e)}this.bullets=this.bullets.filter(function(t){return 1==t.active})}}function Bt(t,i,e,s){this.id=BID++,this.scale=4,this.speed=Z,this.w=50,this.h=50,this.mhWidth=this.w/-2,this.mhHeight=this.h/-2,this.dst=0,this.active=!0,this.hitbox=new p(t,i,this.w,this.h),this.colour="#a205a2",this.dist=0,this.v=new E(t+10,i+10),this.dx=e-t,this.dy=s-i,this.length=Math.sqrt(this.dx*this.dx+this.dy*this.dy),this.dx=this.dx/this.length,this.dy=this.dy/this.length,this.draw=function(t,i){if(this.active){for(xx=this.v.x,yy=this.v.y,this.v.x+=this.dx*t*this.speed,this.v.y+=this.dy*t*this.speed,this.dist+=Math.sqrt((this.v.x-xx)*(this.v.x-xx)+(this.v.y-yy)*(this.v.y-yy)),(this.v.x<0||this.v.x>1300||this.v.y<0||this.v.y>840||this.dist>SHOOTDIST)&&(this.active=!1),this.hitbox.x=this.v.x+this.mhWidth,this.hitbox.y=this.v.y+this.mhHeight,j=0;j<i.length;j++)pc=i[j],person=pc.getPerson(),null!=person&&A(pc.hitbox,this.hitbox)&&null!=person.progress&&person.progress.percent<1&&(person.progress.percent=1,person.progress.happy<5&&(person.progress.happy+=2),person.progress.delivered=!0,person.progress.mHappy=!1,it+=DELIVERED,targets[pc.id]=!1,this.active=!1,st.hero.showTextY=-5,st.hero.showTextTime=HEROTEXTTIME,st.hero.showText="+ S"+DELIVERED);ctx=ot.context,ctx.save(),ctx.translate(this.v.x,this.v.y),ctx.fillStyle=this.colour,ctx.fillRect(.5*this.mhWidth,.5*this.mhHeight,.5*this.w,.5*this.h),ctx.restore()}}}