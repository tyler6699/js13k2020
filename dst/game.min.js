var h,o=[];function n(t,e){for(m=h.createBuffer(1,96e3,48e3),gainNode=h.createGain(),b=m.getChannelData(0),i=96e3;i--;)b[i]=getSound(t,i);s=h.createBufferSource(),s.buffer=m,s.connect(gainNode),gainNode.connect(h.destination),gainNode.gain.value=e,s.start()}function a(t){return 2*Math.random()-1}function d(t){if(t>1e4)return null;var i=(1e4-t)/1e4;return(128&Math.pow(t,1.055)?1:-1)*Math.pow(i,2)}function u(t){if(t>5e4)return null;var i=(5e4-t)/5e4;return(200&Math.pow(t,.9)?1:-1)*Math.pow(i,3)}function f(t){var i=1e4;if(t>i)return null;var s=(i-t)/i,e=Math.pow(s,2.1);return Math.pow(t,3)&(t<3333.3333333333335?16:99)?e:-e}function p(t){if(t>2e4)return null;var i=(2e4-t)/2e4;return Math.sin(.003*-t*Math.sin(.09*t+Math.sin(t/200))+Math.sin(t/100))*i*i}function v(t){if(t>1e4)return null;var i=(1e4-t)/1e4;return Math.sin(.01*t*Math.sin(.009*t+Math.sin(t/200))+Math.sin(t/100))*i*i}function w(i){if(i>2e3)return null;t=((t,i)=>(i-t)/i);var s=t(i,2e3);return 33&Math.pow(50*i,.7)?s:-s}function g(i){if(t=((t,i)=>(i-t)/i),i>2e4)return null;var s=t(i,2e4);return i*=.04,Math.sin(.03*-i*Math.sin(.09*i+Math.sin(i/200))+Math.sin(i/100))*s}function R(){for(this.scale=4,this.cube=16,this.scaled=this.scale*this.cube,this.hero=new P(16,16,F/2,N/2,0,k.HERO,this.scale),this.levels=[],this.surTiles=[-1,1,18,19,20,-18,-19,-20],this.introT=0,i=0;i<9;i++){var t=new W(F,N,i,this.scale);t.reset(i,this.scaled),this.levels.push(t)}this.level=this.levels[0],this.hero.e.currentLevel=0,this.update=function(t,s){this.door=null,Tt()&&(this.hero.e.x-=this.hero.gMove(-1,0),this.hero.e.flip=!0),kt()&&(this.hero.e.x+=this.hero.gMove(1,0),this.hero.e.flip=!1),Ot()&&(this.hero.e.y-=this.hero.gMove(0,-1)),Lt()&&(this.hero.e.y+=this.hero.gMove(0,1)),St()&&(this.menu.curItm=O.GUN),Mt()&&pt.reset(),this.hero.checkDoor(),this.hero.setCurrentTile(this.scaled),this.hero.checkGun(),B($),this.level.draw(this.hero.e,t),gradient=ctx.createLinearGradient(0,0,F,0),gradient.addColorStop("0","#"+at),gradient.addColorStop(".5","#"+nt),ctx.fillStyle=gradient,ctx.font="italic 40px Arial",ctx.fillText("AMMO "+this.hero.e.gun.ammo,900,50),et=!1,this.hero.update(t),mt.canvas.style.cursor="none";let e=it.x,h=it.y;if(mt.context.globalCompositeOperation="difference",mt.context.fillStyle="WHITE",mt.context.fillRect(e-2,h-15,4,30),mt.context.fillRect(e-15,h-2,30,4),mt.context.globalCompositeOperation="source-over",this.introT>0){for(i=0;i<=F/33;i++)for(j=0;j<=N/33;j++)ctx=mt.context,ctx.save(),ctx.translate(32*i,32*j),col=i%2==0&&j%2==0?"#000":"#FFF",ctx.fillStyle=col,ctx.globalAlpha=.5,ctx.fillRect(this.introT/-2,this.introT/-2,this.introT,this.introT),ctx.restore();this.introT-=48*t}this.level.mobs=this.level.mobs.filter(function(t){return 1==t.entity.active}),0!=this.level.mobs.length||this.level.gatesOpen||(this.level.openDoors(),this.hero.roomsDone>=0&&this.hero.roomsDone++),9==this.hero.roomsDone&&(l=this.levels[this.hero.e.currentLevel],l.showPortal=!0,l.complete(),this.hero.roomsDone=-1,tile=this.levels[this.hero.e.currentLevel].tiles[142],tile.entity.type=k.PC,tile.entity.setType()),Dt()&&this.renderMap(),this.renderHP()},this.renderHP=function(){ctx=mt.context,ctx.save(),ctx.translate(0,0),ctx.globalAlpha=1,ctx.fillStyle="#001832",ctx.fillRect(20,20,300,40),ctx.fillStyle="#a12161",l=2.8*this.hero.e.hp,ctx.fillRect(30,30,l,20),ctx.restore()},this.renderMap=function(){ctx=mt.context,ctx.save(),ctx.translate(0,0),ctx.globalAlpha=.8,ctx.fillStyle="WHITE",offX=F/2-180,offY=N/2-180,this.levels.forEach((t,i)=>{var s=i%3*120,e=120*Math.floor(i/3);c=t.gatesOpen?"#a12161":"#001832",t.showPortal&&(c="GOLD"),ctx.fillStyle=c,ctx.fillRect(s+offX,e+offY,100,100),this.level==t&&(ctx.fillStyle="BLACK",ctx.fillRect(s+offX+.065*this.hero.e.x,e+offY+.095*this.hero.e.y,20,20))}),ctx.restore()},this.reset=function(){rt=!1,ct=!1}}function T(t,i,s){this.active=!0,this.open=!1,this.loadRoom=t,this.exitX=i,this.exitY=s}getSound=function(t,i){var s;switch(t){case Nt:s=a(i);break;case Zt:s=f(i);break;case zt:s=d(i);break;case Vt:s=u(i);break;case qt:s=p(i);break;case Jt:s=v(i);break;case Qt:s=w(i);break;case $t:s=g(i);break;default:return 1}return s};const k={FLOOR:1,AIR:2,HERO:3,GRID_1:4,GRID_2:5,GRID_3:6,GRID_4:7,WALL:8,ROCK_1:9,ROCK_2:10,ROCK_3:12,ROCK_4:13,DOOR:14,DOOR_BLOCK:15,DOOR_WALL:16,BARREL:17,TREE:18,CUBE:19,PC:20},O={GUN:0,DESK:1,CHAIR:2,PC:3,SERVER:4,VEND:5,AUTO:6,UP:7},L={FOLLOW:0,SIMPLE:1};function S(t,i,s,e,h,o,r,n){this.entity=new K(t,t,i,s,e,h,"",4,0,0),this.column=r,this.row=n,this.active=!0,this.door=null,this.update=function(t){this.entity.update(t)},this.change=function(){this.entity.type>=Object.values(k).length&&(this.entity.type=0),this.entity.setType()},this.doorSet=function(){return null!=this.door},this.isTile=function(){return!0},this.isDoor=function(){return null!=this.door}}function M(t,i,s,e){this.x=t,this.y=i,this.w=s,this.h=e}function D(t,i){return Math.floor(Math.random()*(i-t+1)+t)}function A(t){return new M(t.x,t.y,t.w,t.h)}function E(t,i,s,e,h,o,r,n){return t<h+r&&t+s>h&&i<o+n&&i+e>o}function C(t,i){return t.x<i.x+i.w&&t.x+t.w>i.x&&t.y<i.y+i.h&&t.y+t.h>i.y}function I(t,i){this.x=t,this.y=i,this.set=function(t,i){this.x=t,this.y=i}}function B(t){mt.context.fillStyle="#FFF";for(let i=2e3;i--;)x=(1e9*Math.sin(i)-t/2e3*(i+1e3)/50)%(mt.canvas.width+9)-9,y=9*i%F,s=i%5,mt.context.fillRect(x,y,s,s)}function _(t){for(i=200;i--;ctx.fillRect(F/2+i*Math.sin(i)*Z,423+i*Math.cos(9*i)*Z,Z,Z))ctx.fillStyle="rgba(255,255,255,"+(i+.1)+")",Z=2**Math.tan(i/9+t/3)}function Y(t,i,s,e,h,o,r,n,a,l){t.save(),t.globalAlpha=a,t.translate(r,n),t.drawImage(i,s,e,h,o,h/2,o/2,h*l,o*l),t.restore()}function H(t,i,s,e,h,o,r,n,a){t.save(),t.globalAlpha=a,t.translate(i,s),t.fillStyle=n,t.fillRect(e,h,o,r),t.restore()}function W(t,i,s,e){this.tiles=[],this.breakTiles=[],this.mvTiles=[],this.bTiles=[],this.mobs=[],this.active=!1,this.complete=!1,this.roomNo=s,this.gatesOpen=!1,this.doors=[0,0,0,0],this.showPortal=!1;this.draw=function(t,i){this.bTiles.forEach(t=>t.update(i)),this.dTiles.forEach(t=>t.update(i)),this.tiles.forEach(t=>t.update(i)),this.mobs.forEach(t=>t.update(i)),this.mvTiles.forEach((t,i)=>{0!=t.entity.mvY&&t.entity.mvY>0&&(t.entity.y++,t.entity.mvY--),0==t.entity.mvY&&(t.entity.alpha=.5,t.entity.isSolid=!1,t.entity.renT2=!0)}),this.mvTiles=this.mvTiles.filter(function(t){return 0!=t.entity.mvY}),this.breakTiles=this.tiles.filter(function(t){return 1==t.entity.breaks})},this.complete=function(){},this.reset=function(t,i){this.tiles=[],this.bTiles=[],this.dTiles=[],this.mobs=[];for(r=0;r<13;r++)for(c=0;c<19;c++)if(xx=c*i,yy=r*i,r>1&&r<13&&c>0&&c<18&&this.bTiles.push(new S(16,xx,yy,0,k.FLOOR,!1,c,r)),r>1&&r<12&&c>0&&c<18){var s=null;D(0,100)>80?s=k.GRID_1:D(0,100)>70?s=k.GRID_2:D(0,100)>70?s=k.GRID_3:D(0,100)>70&&(s=k.GRID_4),null!=s&&this.dTiles.push(new S(16,xx,yy,0,s,!1,c,r))}for(r=0;r<13;r++)for(c=0;c<19;c++){var h;ts=16*e,xx=c*ts,yy=r*ts;s=k.WALL;if(2==r&&c>1&&c<17)s=k.WALL;else if(12==r&&c>0&&c<18)s=k.WALL;else if(0==r||0==c||12==r||18==c)s=k.AIR;else if(1==c||17==c||1==r&&1==c||1==r&&17==c||1==r&&c>1&&c<17||11==r&&17==c||11==r&&1==c||11==r&&c>1&&c<17)s=k.BLOCK;else{if(s=k.AIR,D(0,100)>90&&r>2)switch(D(0,3)){case 0:s=k.ROCK_1;break;case 1:s=k.ROCK_2;break;case 2:s=k.ROCK_3;break;case 3:s=k.ROCK_4}}D(0,100)>98&&r>2&&r<11&&c>1&&c<17&&s==k.AIR&&(s=k.BARREL),D(0,100)>98&&r>2&&r<11&&c>1&&c<17&&s==k.AIR&&(s=k.TREE),D(0,100)>99&&r>2&&r<11&&c>1&&c<17&&s==k.AIR&&(s=k.CUBE),h=new S(16,xx,yy,0,s,!1,c,r),this.tiles.push(h)}switch(t){case 0:this.doorR(),this.doorB(),this.doors=[0,1,0,1];break;case 1:this.doorR(),this.doorL(),this.doorB(),this.doors=[1,1,0,1];break;case 2:this.doorL(),this.doorB(),this.doors=[1,0,0,1];break;case 3:this.doorR(),this.doorB(),this.doorT(),this.doors=[0,1,1,1];break;case 4:this.doorR(),this.doorL(),this.doorT(),this.doorB(),this.doors=[1,1,1,1];break;case 5:this.doorL(),this.doorT(),this.doorB(),this.doors=[1,0,1,1];break;case 6:this.doorR(),this.doorT(),this.doors=[0,1,1,0];break;case 7:this.doorR(),this.doorL(),this.doorT(),this.doors=[1,1,1,0];break;case 8:this.doorT(),this.doorL(),this.doors=[1,0,1,0]}for(noMobs=D(0,3)+yt,m=0;m<noMobs;m++)mb=new X(16,16,200,200+80*m,0,k.DOOR_BLOCK,e,3),mb.isSolid=!1,this.mobs.push(mb)},this.openDoors=function(){this.gatesOpen=!0,this.tiles.forEach((t,i)=>{t.entity.isDoorWall()?t.entity.setT(k.AIR):t.entity.isDoorTop()&&(t.entity.mvY=48,this.mvTiles.push(t)),null!=t.door&&(t.door.open=!0)})},this.doorR=function(){[113,132,151].forEach(t=>this.addDoor(t,s+1,130,-1,k.AIR,!0)),[112,131,150].forEach(t=>this.addDoor(t,0,0,0,k.DOOR_BLOCK,!1))},this.doorL=function(){[95,114,133].forEach(t=>this.addDoor(t,s-1,1024,-1,k.AIR,!0)),[96,115,134].forEach(t=>this.addDoor(t,0,0,0,k.DOOR_BLOCK,!1))},this.doorB=function(){[236,237,238].forEach(t=>this.addDoor(t,s+3,-1,160,k.DOOR_WALL,!0)),[217,218,219].forEach(t=>this.addDoor(t,0,0,0,k.DOOR_BLOCK,!1))},this.doorT=function(){[27,28,29].forEach(t=>this.addDoor(t,s-3,-1,640,k.DOOR_BLOCK,!0)),[46,47,48].forEach(t=>this.addDoor(t,0,0,0,k.DOOR_WALL,!1))},this.addDoor=function(t,i,s,e,h,o=!1){tile=this.tiles[t],tile.entity.setT(h),o&&(tile.door=new T(i,s,e)),[112,96].includes(t)&&(tile.entity.type2=k.DOOR_WALL),[217,218,219,27,28,29].includes(t)&&(tile.entity.type3=k.DOOR_WALL)},this.addAir=function(t){this.tiles[t].entity.setT(k.AIR)},this.addWall=function(t){this.tiles[t].entity.setT(k.WALL)}}function K(t,i,e,h,o,r,n,a,l=!1,c=0){this.scale=a,this.type=r,this.type2=null,this.renT2=!1,this.type3=null,this.t3yOff=0,this.renT3=!1,this.width=t,this.height=i,this.mhWidth=t/-2,this.mhHeight=i/-2,this.mhWScaled=t/-2*a,this.mhHScaled=i/-2*a,this.hWidth=t/2,this.hHeight=i/2,this.yOffset=0,this.angle=o,this.x=e,this.y=h,this.active=!0,this.colour=n,this.image=xt,this.animated=!1,this.anination=null,this.alpha=1,this.currentTile=0,this.colArr=[],this.isSolid=!1,this.isButton=l,this.pc=null,this.gun=null,this.ammo=5,this.time=0,this.showText="",this.showTextTime=0,this.showTextY=0,this.shootTime=0,this.maxHP=c,this.hp=this.maxHP,this.mvY=0,this.breaks=!1,this.flip=!1,this.idle=0,this.sx=0,this.sy=0,this.setHitbox=function(){this.hb=new M(0,0,0,0),this.sensor=new M(0,0,0,0),this.isButton&&(this.hb.w=2*this.width,this.hb.h=2*this.height)},this.setHitbox(),this.updateHitbox=function(){this.isButton?(this.hb.x=this.x-this.width,this.hb.y=this.y-this.height):(this.hb.x=this.x+this.scale/2,this.hb.y=this.y+this.scale/2,this.hb.w=this.width*this.scale-this.scale,this.hb.h=this.height*this.scale-this.scale,this.sensor.x=this.x-5,this.sensor.y=this.y-5,this.sensor.w=this.width*this.scale+10,this.sensor.h=this.height*this.scale+10)},this.update=function(e){this.idle+=e,this.updateHitbox(),this.active&&(ctx=mt.context,ctx.save(),ctx.translate(this.x,this.y),ctx.rotate(this.angle),ctx.globalAlpha=this.alpha,img=this.image,s=this.scale,mhw=this.mhWidth,mhh=this.mhHeight,hw=this.hWidth,hh=this.hHeight,t=this.width,i=this.height,null==this.image||this.isButton?(ctx.fillStyle=this.colour,ctx.fillRect(.5*mhw*s,.5*mhh*s,.5*t*s,.5*i*s)):(this.flip?(ctx.scale(-1,1),ctx.translate(-80,0)):ctx.scale(1,1),ctx.drawImage(img,this.sx,this.sy,t,i,hw,hh,t*s,i*s)),null!=this.type2&&0!=this.mvY?(ctx.translate(0,-48+this.mvY),ctx.drawImage(img,0,16,t,i,hw,hh,t*s,i*s),ctx.translate(0,48-this.mvY),ctx.drawImage(img,this.sx,this.sy,t,i,hw,hh,t*s,i*s)):null!=this.type3&&0!=this.mvY?(ctx.translate(0,64-(48-this.mvY)),ctx.drawImage(img,112,16,t,i,hw,hh,t*s,i*s),ctx.translate(0,48-this.mvY-64),ctx.drawImage(img,this.sx,this.sy,t,i,hw,hh,t*s,i*s)):null!=this.type2&&this.renT2&&(ctx.globalAlpha=1,ctx.translate(0,-48),ctx.drawImage(img,0,16,t,i,hw,hh,t*s,i*s)),this.showTextTime>0&&(this.showTextTime-=e,gradient=ctx.createLinearGradient(0,0,F,0),gradient.addColorStop("0","#"+at),gradient.addColorStop(".1","#"+nt),ctx.font="italic 25px Arial",ctx.fillStyle=gradient,ctx.fillText(this.showText,0,this.showTextY+10*this.showTextTime)),ctx.restore())},this.isHero=function(){return this.type==k.HERO},this.isDoor=function(){return this.type==k.DOOR||this.type==k.DOOR_BLOCK||this.type==k.DOOR_WALL},this.isDoorWall=function(){return this.type==k.DOOR_WALL},this.isDoorTop=function(){return this.type==k.DOOR_BLOCK},this.isBarrel=function(){return this.type==k.BARREL},this.isTree=function(){return this.type==k.TREE},this.isTile=function(){return!1},this.setT=function(t){this.type=t,this.setType()},this.isFloor=function(){return this.type==k.FLOOR},this.isPortal=function(){return this.type==k.PC},this.setType=function(){switch(this.alpha=1,this.sy=0,this.sx=0,this.isSolid=!0,this.type){case k.HERO:this.sx=96,this.sy=16,this.isSolid=!0;break;case k.WALL:this.sy=16,this.isSolid=!1;break;case k.BLOCK:this.sx=16;break;case k.FLOOR:this.sx=32,this.sy=32,this.alpha=.9,this.isSolid=!1;break;case k.AIR:case k.DOOR:this.sx=144,this.isSolid=!1;break;case k.DOOR_BLOCK:this.sx=112,this.isSolid=!0;break;case k.DOOR_WALL:this.sy=16,this.sx=112,this.isSolid=!1;break;case k.GRID_1:this.sx=96,this.sy=32,this.isSolid=!1;break;case k.GRID_2:this.sx=112,this.sy=32,this.isSolid=!1;break;case k.GRID_3:this.sx=80,this.sy=32,this.isSolid=!1;break;case k.GRID_4:this.sx=48,this.sy=32,this.isSolid=!1;break;case k.ROCK_1:this.sx=48,this.isSolid=!1;break;case k.ROCK_2:this.sx=64,this.isSolid=!1;break;case k.ROCK_3:this.sx=80,this.isSolid=!1;break;case k.ROCK_4:this.sx=96,this.isSolid=!1;break;case k.BARREL:this.hp=5,this.breaks=!0,this.sx=48,this.sy=16;break;case k.TREE:this.breaks=!0,this.sx=16,this.sy=32;break;case k.CUBE:this.hp=10,this.breaks=!0,this.sx=32,this.sy=16;break;case k.PC:this.isSolid=!0,this.sx=80,this.sy=16;break;case k.CHEST:this.isSolid=!0,this.sx=64,this.sy=32}},this.setType()}function P(t,i,s,e,h,o,r){this.e=new K(t,i,s,e,h,o,"",r,!1,100),this.e.hp=100,this.e.gun=new ti,this.speed=5,this.door=null,this.currentTile=null,this.roomsDone=0,this.level=0,this.levelUp=!1,this.levelUpTime=0,this.update=function(t){this.time+=t,this.e.gun.drawBullets(t),this.e.update(t)},this.checkGun=function(){ht&&(ot+=q),(et||ot>.25)&&(ox=this.e.x-this.e.mhWScaled,oy=this.e.y-this.e.mhHScaled,dx=st.x,dy=st.y,this.e.gun.addBullets(ox,oy,dx,dy))},this.checkDoor=function(){null!=this.door&&(this.e.gun.bullets=[],pt.level=pt.levels[this.door.loadRoom],this.e.currentLevel=this.door.loadRoom,-1!=this.door.exitX&&(this.e.x=this.door.exitX),-1!=this.door.exitY&&(this.e.y=this.door.exitY),this.door=null,pt.introT=32,n($t,5))},this.setCurrentTile=function(t){heroRow=Math.floor((this.e.y-this.e.mhHScaled)/t),heroCol=Math.floor((this.e.x-this.e.mhWScaled)/t),heroTileIndex=heroCol+19*heroRow,null!=this.currentTile&&(this.prevTile=this.currentTile),this.currentTile=pt.level.tiles[heroTileIndex],this.currentTile!=this.prevTile&&(this.e.colArr=[],pt.surTiles.forEach(t=>this.e.colArr.push(pt.level.tiles[heroTileIndex+t])),pt.level.mobs.forEach(t=>this.e.colArr.push(t.entity)))},this.gMove=function(t,i){rec=A(this.e.hb),rec.x+=t*this.speed,rec.y+=i*this.speed,amount=this.speed,stop=!1,canMove=!0;for(var s=this.speed;s>0;s--){canMove=!0;for(var e=0;e<this.e.colArr.length;e++)if(obj=this.e.colArr[e],obj.isTile()){if(!stop&&C(obj.entity.hb,rec)){if(obj.entity.isPortal()&&!this.levelUp){canMove=!1,this.levelUp=!0,this.level++,n(Nt,.5);break}if(obj.active&&obj.entity.isSolid){canMove=!1;break}if(obj.isDoor&&obj.doorSet()){this.door=obj.door,stop=!0;break}obj.entity.isBarrel()&&(this.e.hp-=.5)}}else if(!stop&&obj.active&&obj.isSolid&&C(obj.hb,rec)){canMove=!1;break}if(canMove||stop)break;amount--,rec.x-=t,rec.y-=i}return amount}}function X(t,i,s,h,o,r,n,a){this.entity=new K(t,i,s,h,o,r,"",n,!1,a),this.type=L.FOLLOW,this.spd=D(1,2),this.colArr=[],this.noX=!1,this.noY=!1,this.waitX=1,this.waitY=1,this.time=0,this.tryXSpeed=this.spd,this.tryYSpeed=this.spd,this.update=function(t){this.time+=t,this.time>2&&(this.time=0,this.noX=!1,this.noY=!1,this.waitY=0,this.waitX=0,this.tryXSpeed=D(0,10)>5?this.spd:-this.spd,this.tryYSpeed=D(0,10)>5?this.spd:-this.spd);var i=this.entity.x,s=this.entity.y;row=Math.floor((s-this.entity.mhHScaled)/pt.scaled),col=Math.floor((i-this.entity.mhWScaled)/pt.scaled),index=col+19*row,e=this.entity,this.type==L.FOLLOW?(this.noX&&this.waitX>0?(this.waitX-=t,e.y=s+=this.move(0,this.tryYSpeed)):e.y=s<pt.hero.e.y?s+=this.move(0,this.spd):s+=this.move(0,-this.spd),this.noY&&this.waitY>0?(this.waitY-=t,e.x=i+=this.move(this.tryXSpeed,0)):e.x=i<pt.hero.e.x?i+=this.move(this.spd,0):i+=this.move(-this.spd,0)):this.type==L.SIMPLE&&(e.y=s<pt.hero.e.y?s+=this.move(0,this.spd):s+=this.move(0,-this.spd),e.x=i<pt.hero.e.x?i+=this.move(this.spd,0):i+=this.move(-this.spd,0)),this.colArr=[],pt.surTiles.forEach(t=>this.colArr.push(pt.level.tiles[index+t].entity)),this.colArr.push(pt.hero.e),pt.level.mobs.forEach(t=>this.colArr.push(t.entity)),e.update(t),e.hp<e.maxHP&&(Y(ctx,e.image,0,32,e.width,8,e.x,e.y+(e.height*e.scale+10),.8,e.scale),H(ctx,e.x,e.y+(e.height*e.scale+12),16,14,48/e.maxHP*e.hp,12,"#00dcf8",.8))},this.move=function(t,i){rec=A(this.entity.hb),rec.x+=t,rec.y+=i,canMove=!0,amount=t+i;for(var s=0;s<this.colArr.length;s++)if(obj=this.colArr[s],obj!=this.entity&&obj.isSolid&&C(obj.hb,rec)){canMove=!1,amount=0;break}return 0==amount?0!=t?(this.noX=!0,this.waitX=.8):(this.noY=!0,this.waitY=.8):0!=t&&0==this.waitX?this.noX=!1:0==this.waitY&&(this.noY=!1),amount}}var G,U,F=1232,N=846,V=!1,q=0,J=Date.now(),Q=Date.now(),$=0,tt=0,it=new I(0,0),st=new I(0,0),et=!1,ht=!1,ot=0,rt=!1,nt="990099",at="05f2db",lt=1e3,ct=!1,dt=0,ut=50,ft=600,yt=1,xt=new Image;xt.src="atlas.png";var pt=new R,vt=!1;function startGame(){mt.start()}var mt={canvas:document.createElement("canvas"),start:function(){this.canvas.width=F,this.canvas.height=N,this.context=this.canvas.getContext("2d"),this.context.scale(1,1),this.context.mozImageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.context.imageSmoothingEnabled=!1,this.canvas.classList.add("screen"),document.body.insertBefore(this.canvas,document.body.childNodes[6]),this.frameNo=0,this.interval=setInterval(wt,20),window.addEventListener("keydown",function(t){t.preventDefault(),mt.keys=mt.keys||[],mt.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("keyup",function(t){mt.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("mousedown",function(t){t.preventDefault(),mt.keys=mt.keys||[],mt.keys[t.button]=!0,ht=!0}),window.addEventListener("mouseup",function(t){t.preventDefault(),mt.keys=mt.keys||[],mt.keys[t.button]=!1,ht=!1,ot=0,et=!0,vt||(vt=!0),bt()}),window.addEventListener("mousemove",function(t){t.preventDefault();var i=mt.canvas.getBoundingClientRect();it.set((t.clientX-i.left)/(i.right-i.left)*F,(t.clientY-i.top)/(i.bottom-i.top)*N),row=Math.floor(it.y/this.scaled),col=Math.floor(it.x/this.scaled),bt()}),this.canvas.oncontextmenu=function(t){t.preventDefault()}},stop:function(){clearInterval(this.interval)},clear:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}};function bt(){st.set(it.x,it.y)}function wt(){vt&&(V=!0,null==h&&(h=new AudioContext)),J=Q,Q=Date.now(),$+=q=Q-J,V?pt.hero.levelUp?(mt.clear(),_($/100),t=$/1e3,x=488+40*Math.cos(t),y=295+20*Math.sin(t),ctx.drawImage(pt.hero.e.image,96,16,16,13,x-80,y+40,256,208),ctx.drawImage(pt.hero.e.image,32,48,16,16,x,y,256,256),pt.hero.levelUpTime+=q/1e3,pt.hero.levelUpTime>2&&(pt.hero.levelUpTime=0,pt.hero.levelUp=!1)):(mt.clear(),pt.update(q/1e3,$)):(mt.clear(),ctx=mt.context,ctx.save(),gt(ctx,.1,"#"+nt,0,0,F,N),Rt(ctx,1,"italic 50px Arial","WHITE","[ CLICK TO START ]",380,720),z=$/1600,Rt(ctx,1,"italic 90px Arial","WHITE","SPACE KITTY",300+40*Math.cos(z),200+20*Math.sin(z)),B($),ctx.setTransform(1,0,0,1,0,0),t=$/1e3,x=488+40*Math.cos(t),y=295+20*Math.sin(t),ctx.drawImage(pt.hero.e.image,96,16,16,13,x-80,y+40,256,208),ctx.drawImage(pt.hero.e.image,32,48,16,16,x,y,256,256))}function gt(t,i,s,e,h,o,r){t.globalAlpha=i,t.fillStyle=s,t.fillRect(e,h,o,r)}function Rt(t,i,s,e,h,o,r){t.globalAlpha=i,t.font=s,t.fillStyle=e,t.fillText(h,o,r)}function Tt(){return mt.keys&&(mt.keys[At]||mt.keys[_t])}function kt(){return mt.keys&&(mt.keys[Et]||mt.keys[Ht])}function Ot(){return mt.keys&&(mt.keys[Ct]||mt.keys[Bt])}function Lt(){return mt.keys&&(mt.keys[It]||mt.keys[Yt])}function St(){return mt.keys&&mt.keys[Pt]}function Mt(){return mt.keys&&mt.keys[Xt]}function Dt(){return mt.keys&&mt.keys[Wt]}var At=37,Et=39,Ct=38,It=40,Bt=87,_t=65,Yt=83,Ht=68,Wt=77,Kt=0,jt=2,Pt=32,Xt=49,Gt=50,Ut=51,Ft=52,Nt=0,Zt=1,zt=2,Vt=3,qt=4,Jt=5,Qt=6,$t=7;function ti(){this.ammo=ut,this.bullets=[],this.rate=.1,this.wait=0,this.addBullets=function(t,i,s,e){if(this.ammo>0&&this.wait<=0){this.wait=this.rate;var h=Math.atan2(e-i,s-t),o=t+60*Math.cos(h),r=i+60*Math.sin(h);this.bullets.push(new ii(t,i,o,r)),n(Qt,.5),this.ammo--}},this.drawBullets=function(t){this.wait>0&&(this.wait-=t),this.bullets.forEach(i=>i.draw(t)),this.bullets=this.bullets.filter(function(t){return 1==t.active})}}function ii(t,i,s,e){this.scale=4,this.speed=lt,this.w=50,this.h=20,this.mhWidth=this.w/-2,this.mhHeight=this.h/-2,this.dst=0,this.active=!0,this.hb=new M(t,i,this.w,this.h),this.colour="#a12161",this.dist=0,this.accuracy=.1,this.v=new I(t+10,i+10),dir=Math.atan2(i-e,t-s)+Math.PI+2*(Math.random()-.5)*this.accuracy,this.dx=Math.cos(dir),this.dy=Math.sin(dir),this.angle=Math.atan2(i-e,t-s),this.checkHits=function(t){C(t.hb,this.hb)&&t.hp>=0&&(t.hp--,this.active=!1,t.hp<0&&(n(Jt,.5),t.isBarrel()?(t.sx=0,t.sy=48):t.isTree()?t.sy=48:t.active=!1,t.isSolid=!1))},this.draw=function(t){this.active&&(xx=this.v.x,yy=this.v.y,this.v.x+=this.dx*t*this.speed,this.v.y+=this.dy*t*this.speed,this.dist+=Math.sqrt((this.v.x-xx)*(this.v.x-xx)+(this.v.y-yy)*(this.v.y-yy)),(this.v.x<0||this.v.x>1300||this.v.y<0||this.v.y>840||this.dist>ft)&&(this.active=!1),this.hb.x=this.v.x+this.mhWidth,this.hb.y=this.v.y+this.mhHeight,pt.level.mobs.forEach(t=>this.checkHits(t.entity)),pt.level.breakTiles.forEach(t=>this.checkHits(t.entity)),ctx=mt.context,ctx.save(),ctx.translate(this.v.x,this.v.y),ctx.rotate(this.angle),ctx.fillStyle=this.colour,ctx.fillRect(.5*this.mhWidth,.5*this.mhHeight,.5*this.w,.5*this.h),ctx.restore())}}