var e,h=!1,n=!1,o={songData:[{i:[3,162,128,0,3,0,128,0,0,0,5,6,45,0,0,0,0,6,1,2,255,0,6,69,0,6,0,6],p:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,27,33,27,33,27,33,27,33],c:[{n:[113,,113,113,113,,113,113,,108,113,108,115,116,111,108,,113,113,,113,,113,113,,108,113,108,115,116,111,115],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[121,,121,121,121,,121,121,,116,121,116,123,125,116,121,,120,120,,120,,120,120,,111,115,111,118,120,123,125],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[118,,118,118,118,,118,118,,113,118,113,120,121,123,115,,115,115,,115,,115,115,,113,111,113,115,116,118,120],f:[]}]},{i:[0,119,128,1,3,0,128,0,0,0,0,0,43,0,0,0,0,6,1,2,255,117,3,212,0,6,0,6],p:[,,,,2,2,2,,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],c:[{n:[],f:[]},{n:[125,,,125,,,125,125,,,125,,,,,,,,125,125,,,,125,,,125],f:[]}]},{i:[2,0,128,0,3,0,128,0,0,196,5,6,41,0,0,0,0,6,1,2,149,0,0,116,0,6,27,6],p:[,,,7,3,3,3,7,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],c:[{n:[],f:[]},{n:[],f:[]},{n:[,,,,137,,,,,,,,137,,,,,,,,137,,,,,,,,137,,137,137],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,137,,137,137],f:[]}]},{i:[2,0,128,0,3,0,128,0,0,131,5,6,29,0,0,0,0,6,1,1,135,0,0,32,147,6,92,2],p:[,,4,8,4,4,4,8,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[185,,,185,,,185,,,185,,,185,185,,,185,,,185,,,185,,,185,,,185,185],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[185,,,185,,,185,,,185,,,185,185],f:[]}]},{i:[2,100,128,0,1,201,128,0,0,0,5,6,44,0,0,0,0,6,1,2,83,0,0,5,147,6,45,6],p:[,,,,5,5,5,5,5,5,5,5,5,5,5,5,11,29,11,29,11,29,11,29],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[137,137,137,,137,137,,137,,137,137,,137,137,,137,,125,125,,137,137,,137,,137,137,,137,137,,137,140,140,140,,140,140,,140,,140,140,,140,140,,140,,128,128,,140,140,,140,,140,140,,140,140,,140,144,144,144,,144,144,,144,,144,144,,144,144,,144,,132,132,,144,144,,144,,144,144,,144,144,,144,147,147,147,,147,147,,147,,147,147,,147,147,,147,,135,135,,147,147,,147,,147,147,,147,147,,147],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[137,137,137,,137,137,,137,,137,137,,137,137,,137,,123,123,,135,135,,135,,135,135,,135,135,,135,140,140,140,,140,140,,140,,140,140,,140,140,,140,,127,127,,139,139,,139,,139,139,,139,139,,139,144,144,144,,144,144,,144,,144,144,,144,144,,144,,130,130,,142,142,,142,,142,142,,142,142,,142,147,147,147,,147,147,,147,,147,147,,147,147,,147,,132,132,,144,144,,144,,144,144,,144,144,,144],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[137,137,137,,137,137,,137,,137,137,,137,137,,137,,123,123,,135,135,,135,,135,135,,135,135,,135,140,140,140,,140,140,,140,,140,140,,140,140,,140,,127,127,,139,139,,139,,139,139,,139,139,,139,142,142,142,,142,142,,142,,142,142,,142,142,,142,,130,130,,142,142,,142,,142,142,,142,142,,142,145,145,145,,145,145,,145,,145,145,,145,145,,145,,133,133,,145,145,,145,,145,145,,145,145,,145],f:[]}]},{i:[1,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,0,6,1,2,188,53,0,32,0,6,27,6],p:[,,,,,,,,6,9,6,10,6,9,6,10,36,34,13,32,36,34,13,32],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,,,152,,,,151,,147,,,,154,,,,152,,,,151,,,,147,,144,,142],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,,,152,,,,151,,147,,,,154,,,,156,,,,144,,154,,152,,151,,152],f:[]},{n:[,,,,152,,,,151,,147,,,,140,,151,,152,,142,,154,,156,,144,,159,,161],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,,,149,,,,152,,,,157,,,,159,,,,161,,159,,,,152,,163,,164],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,166,,164,,163,,159,,,,,,164,,163,,159,,156,,,,154,156,157,159,161,156,152,151],f:[]},{n:[],f:[]},{n:[,,157,,156,,152,,149,,,,147,,149,,151,,152,,151,,147,,142,140,139,140,142,144,145,147],f:[]},{n:[],f:[]},{n:[,,,,149,,,,152,,,,157,,,,159,,,,161,,159,,,,152,,156,,157],f:[]}]}],rowLen:5088,patternLen:32,endPattern:23,numChannels:6},r=function(){var t,i,e,s,h,n=function(t){return Math.sin(6.283184*t)},o=function(t){return.003959503758*Math.pow(2,(t-128)/12)},r=function(t,i,e){var s,h,n,r,c,a,f,u=l[t.i[0]],x=t.i[1],d=t.i[3],y=l[t.i[4]],p=t.i[5],w=t.i[8],v=t.i[9],b=t.i[10]*t.i[10]*4,g=t.i[11]*t.i[11]*4,T=t.i[12]*t.i[12]*4,m=1/T,L=t.i[13],A=e*Math.pow(2,2-t.i[14]),R=new Int32Array(b+g+T),k=0,I=0;for(s=0,h=0;s<b+g+T;s++,h++)h>=0&&(h-=A,a=o(i+(15&(L=L>>8|(255&L)<<4))+t.i[2]-128),f=o(i+(15&L)+t.i[6]-128)*(1+8e-4*t.i[7])),n=1,s<b?n=s/b:s>=b+g&&(n-=(s-b-g)*m),r=a,d&&(r*=n*n),c=u(k+=r)*x,r=f,w&&(r*=n*n),c+=y(I+=r)*p,v&&(c+=(2*Math.random()-1)*v),R[s]=80*c*n|0;return R},l=[n,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var i=t%1*4;return i<2?i-1:3-i}];this.init=function(n){t=n,i=n.endPattern,e=0,s=n.rowLen*n.patternLen*(i+1)*2,h=new Int32Array(s)},this.generate=function(){var o,c,a,f,u,x,d,y,p,w,v,b,g,T,m=new Int32Array(s),L=t.songData[e],A=t.rowLen,R=t.patternLen,k=0,I=0,O=!1,S=[];for(a=0;a<=i;++a)for(d=L.p[a],f=0;f<R;++f){var _=d?L.c[d-1].f[f]:0;_&&(L.i[_-1]=L.c[d-1].f[f+R]||0,_<16&&(S=[]));var C=l[L.i[15]],W=L.i[16]/512,M=Math.pow(2,L.i[17]-9)/A,E=L.i[18],D=L.i[19],H=43.23529*L.i[20]*3.141592/44100,B=1-L.i[21]/255,G=1e-5*L.i[22],P=L.i[23]/32,K=L.i[24]/512,F=6.283184*Math.pow(2,L.i[25]-9)/A,X=L.i[26]/255,Y=L.i[27]*A&-2;for(v=(a*R+f)*A,u=0;u<4;++u)if(x=d?L.c[d-1].n[f+u*R]:0){S[x]||(S[x]=r(L,x,A));var N=S[x];for(c=0,o=2*v;c<N.length;c++,o+=2)m[o]+=N[c]}for(c=0;c<A;c++)(w=m[y=2*(v+c)])||O?(b=H,E&&(b*=C(M*y)*W+.5),I+=(b=1.5*Math.sin(b))*(g=B*(w-I)-(k+=b*I)),w=3==D?I:1==D?g:k,G&&(w=(w*=G)<1?w>-1?n(.25*w):-1:1,w/=G),O=(w*=P)*w>1e-5,T=w*(1-(p=Math.sin(F*y)*K+.5)),w*=p):T=0,y>=Y&&(T+=m[y-Y+1]*X,w+=m[y-Y]*X),m[y]=0|T,m[y+1]=0|w,h[y]+=0|T,h[y+1]+=0|w}return++e/t.numChannels},this.createWave=function(){var t=44+2*s-8,i=t-36,e=new Uint8Array(44+2*s);e.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&i,i>>8&255,i>>16&255,i>>24&255]);for(var n=0,o=44;n<s;++n){var r=h[n];r=r<-32767?-32767:r>32767?32767:r,e[o++]=255&r,e[o++]=r>>8&255}return e},this.getData=function(t,i){for(var e=2*Math.floor(44100*t),s=new Array(i),n=0;n<2*i;n+=1){var o=e+n;s[n]=t>0&&o<h.length?h[o]/32768:0}return s}};function l(){var t=new r;t.init(o),setInterval(function(){if(!h&&(h=t.generate()>=1)){var i=t.createWave();(e=document.createElement("audio")).src=URL.createObjectURL(new Blob([i],{type:"audio/wav"})),n=!0}},0)}const c={WALL_R:0,WALL_L:1,WALL_T:2,WALL_B:3,WALL_RT:4,WALL_LT:5,WALL_BR:6,WALL_BL:7,FLOOR:8,AIR:9,HERO:10,GRID_1:11,GRID_2:12,GRID_3:13,GRID_4:14,WALL:15,ROCK_1:16,ROCK_2:17,ROCK_3:18,ROCK_4:19},a={GUN:0,DESK:1,CHAIR:2,PC:3,SERVER:4,VEND:5,AUTO:6,UP:7};function f(t,i,e,s,h,n,o,r){this.entity=new O(t,t,i,e,s,h,"",4,hitboxOffsetX=0,hitboxOffsetY=0),this.entity.setType(),this.column=o,this.row=r,this.active=!0,this.update=function(t){this.entity.update(t)},this.change=function(){this.entity.type>=Object.values(c).length&&(this.entity.type=0),this.entity.setType()},this.isFloor=function(){return this.entity.isFloor()},this.person=function(){return this.entity.person}}function u(t){et.hero.showTextY=-15,et.hero.showTextTime=TEXTTIME/2,et.hero.showText=t}function d(t,i,e,s){this.x=t,this.y=i,this.w=e,this.h=s}function p(t,i){return i.tiles[t]}function w(t,i){return Math.floor(Math.random()*(i-t+1)+t)}function v(){for(var t="#",i=0;i<6;i++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t}function g(t){return new d(t.x,t.y,t.w,t.h)}function T(t,i,e){return new d(t.x,t.y,i,e)}function m(t,i,e,s,h,n,o,r){return t<h+o&&t+e>h&&i<n+r&&i+s>n}function L(t,i){return t.x<i.x+i.w&&t.x+t.w>i.x&&t.y<i.y+i.h&&t.y+t.h>i.y}function A(t,i){this.x=t,this.y=i,this.set=function(t,i){this.x=t,this.y=i}}function R(t){nt.context.fillStyle="#FFF";for(let i=2e3;i--;)x=(1e9*Math.sin(i)-t/2e3*(i+1e3)/50)%(nt.canvas.width+9)-9,y=9*i%nt.canvas.height,s=i%5,nt.context.fillRect(x,y,s,s)}function k(t,i){return Object.values(t)[i]}function I(t,e,s){this.tiles=[],this.backTiles=[],this.startX=0,this.startY=0,this.canvasHalfW=t/2,this.canvasHalfH=e/2,this.levels=[],this.active=!1,this.complete=!1,this.maxLevels;this.draw=function(t,e){for(i=0;i<this.backTiles.length;i++){this.backTiles[i].update(e)}for(i=0;i<this.decorTiles.length;i++){this.decorTiles[i].update(e)}for(i=0;i<this.tiles.length;i++){this.tiles[i].update(e)}},this.reset=function(t,i){var e=null!=t?t.currentLevel:0;this.tiles=[],this.backTiles=[],this.decorTiles=[],this.levels[e];for(row=0;row<13;row++)for(col=0;col<19;col++)if(xx=16*col*i,yy=16*row*i,row>1&&row<12&&col>0&&col<18&&this.backTiles.push(new f(16,xx,yy,0,c.FLOOR,!1,col,row)),(2==row||12==row)&&col>0&&col<18)this.decorTiles.push(new f(16,xx,yy,0,c.WALL,!1,col,row));else if(row>1&&row<12&&col>0&&col<18){var s=null;w(0,100)>80?s=c.GRID_1:w(0,100)>70?s=c.GRID_2:w(0,100)>70?s=c.GRID_3:w(0,100)>70&&(s=c.GRID_4),null!=s&&this.decorTiles.push(new f(16,xx,yy,0,s,!1,col,row))}for(row=0;row<13;row++)for(col=0;col<19;col++){var h;xx=16*col*i,yy=16*row*i;s=c.WALL;if(0==row||0==col||12==row||18==col)s=c.AIR;else if(1==row&&1==col)s=c.WALL_RT;else if(1==row&&col>1&&col<17)s=c.WALL_T;else if(1==row&&17==col)s=c.WALL_LT;else if(11==row&&17==col)s=c.WALL_BR;else if(11==row&&1==col)s=c.WALL_BL;else if(11==row&&col>1&&col<17)s=c.WALL_B;else if(17==col)s=c.WALL_R;else if(1==col)s=c.WALL_L;else if(s=c.AIR,w(0,100)>90&&row>2){var n=w(0,3);1==n?s=c.ROCK_1:2==n?s=c.ROCK_2:3==n?s=c.ROCK_3:4==n&&(s=c.ROCK_4)}h=new f(16,xx,yy,0,s,!1,col,row),this.tiles.push(h)}}}function O(t,i,e,s,h,n,o,r,l=0,a=0,f=!1){this.scale=r,this.type=n,this.width=t,this.height=i,this.mhWidth=t/-2,this.mhHeight=i/-2,this.mhWidthScaled=t/-2*r,this.mhHeightScaled=i/-2*r,this.hWidth=t/2,this.hHeight=i/2,this.yOffset=0,this.yDrawOffset=0,this.angle=h,this.x=e,this.y=s,this.active=!0,this.colour=o,this.image=it,this.animated=!1,this.anination=null,this.hitboxOffsetX=l,this.hitboxOffsetY=a,this.alpha=1,this.currentTile=0,this.collisionArray=[],this.isSolid=!1,this.isButton=f,this.drawTile=!1,this.pc=null,this.person=null,this.gun=null,this.ammo=5,this.time=0,this.showText="",this.showTextTime=0,this.showTextY=0,this.currentGift=0,this.shootTime=0,this.hover=!1,this.hoverText="",this.hoverText2="",this.sx=0,this.sy=0,this.setHitbox=function(){this.hitbox=new d(0,0,0,0),this.sensor=new d(0,0,0,0),this.isButton&&(this.hitbox.w=2*this.width,this.hitbox.h=2*this.height)},this.setHitbox(),this.updateHitbox=function(){this.isButton?(this.hitbox.x=this.x-this.width,this.hitbox.y=this.y-this.height):(this.hitbox.x=this.x+this.hitboxOffsetX*this.scale/2,this.hitbox.y=this.y+this.hitboxOffsetX*this.scale/2,this.hitbox.w=this.width*this.scale-this.hitboxOffsetX*this.scale,this.hitbox.h=this.height*this.scale-this.hitboxOffsetY*this.scale,this.sensor.x=this.x-5,this.sensor.y=this.y-5,this.sensor.w=this.width*this.scale+10,this.sensor.h=this.height*this.scale+10)},this.isFloor=function(){return this.type==c.FLOOR},this.update=function(t){this.updateHitbox(),this.active&&(ctx=nt.context,ctx.save(),ctx.translate(this.x,this.y),this.drawTile&&(ctx.globalAlpha=.4,ctx.drawImage(this.image,48,0,16,16,8,8,64,64)),ctx.globalAlpha=this.alpha,null==this.image||this.isButton?(ctx.fillStyle=this.colour,ctx.fillRect(.5*this.mhWidth*this.scale,.5*this.mhHeight*this.scale,.5*this.width*this.scale,.5*this.height*this.scale)):ctx.drawImage(this.image,this.sx,this.sy,this.width,this.height,this.hWidth,this.hHeight+this.yDrawOffset,this.width*this.scale,this.height*this.scale),this.showTextTime>0?(this.showTextTime-=t,gradient=ctx.createLinearGradient(0,0,D,0),gradient.addColorStop("0","#"+Q),gradient.addColorStop(".1","#"+J),ctx.font="italic 25px Arial",ctx.fillStyle=gradient,ctx.fillText(this.showText,0,this.showTextY+10*this.showTextTime)):this.currentGift=0,this.isButton&&(by=32,bx=48,ctx.drawImage(this.image,bx,by,10,10,-16,-16,32,32),this.hover&&(ctx.globalAlpha=.8,ctx.fillStyle="#"+J,ctx.fillRect(-215,-50,167,100),ctx.fillStyle=this.colour,ctx.fillRect(-200,-32,165,64),ctx.globalAlpha=1,ctx.font="italic 25px Arial",ctx.fillStyle="#"+J,ctx.fillText(this.hoverText,-180,-5),ctx.fillText(this.hoverText2,-180,20))),ctx.restore())},this.isHero=function(){return this.type==c.HERO},this.setType=function(){switch(this.alpha=1,this.sy=0,this.sx=0,this.yDrawOffset=0,this.hitboxOffsetY=0,this.isSolid=!0,this.type){case c.WALL:this.sy=16,this.isSolid=!1;break;case c.WALL_R:break;case c.WALL_RT:this.sx=16,this.sy=16;break;case c.WALL_LT:this.sx=32,this.sy=0;break;case c.WALL_L:break;case c.WALL_T:case c.WALL_B:this.sx=16,this.sy=0;break;case c.WALL_BR:case c.WALL_BL:this.sx=16,this.sy=16;break;case c.FLOOR:this.sx=32,this.sy=32,this.alpha=.9,this.isSolid=!1,this.drawTile=!1;break;case c.AIR:this.sx=144,this.isSolid=!1;break;case c.GRID_1:this.sx=96,this.sy=32,this.isSolid=!1;break;case c.GRID_2:this.sx=112,this.sy=32,this.isSolid=!1;break;case c.GRID_3:this.sx=80,this.sy=32,this.isSolid=!1;break;case c.GRID_4:this.sx=48,this.sy=32,this.isSolid=!1;break;case c.ROCK_1:this.sx=48,this.isSolid=!1;break;case c.ROCK_2:this.sx=64,this.isSolid=!1;break;case c.ROCK_3:this.sx=80,this.isSolid=!1;break;case c.ROCK_4:this.sx=96,this.isSolid=!1}}}function S(){xOffset=5,yOffset=5,this.scale=4,this.hero=new O(16,16,D/2,H/2,0,c.HERO,"",this.scale,xOffset,yOffset),this.hero.sx=16,this.speed=8,this.level=new I(D,H,0),this.hero.currentLevel=0,this.level.reset(this.hero,this.scale),this.menu=new St(this.scale),this.update=function(t,i){rt()&&(this.hero.x-=this.gMove(-this.speed,0)),lt()&&(this.hero.x+=this.gMove(this.speed,0)),ct()&&(this.hero.y-=this.gMove(0,-this.speed)),at()&&(this.hero.y+=this.gMove(0,this.speed)),ft()&&(this.menu.curItm=a.GUN),ut()&&et.reset(),heroRow=Math.floor((this.hero.y-this.hero.mhHeightScaled)/64),heroCol=Math.floor((this.hero.x-this.hero.mhWidthScaled)/64),heroTileIndex=heroCol+19*heroRow,null!=this.currentTile&&(this.prevTile=this.currentTile),this.currentTile=this.level.tiles[heroTileIndex],this.currentTile!=this.prevTile&&(this.hero.collisionArray=[],heroTileIndex&&this.hero.collisionArray.push(this.level.tiles[heroTileIndex-1]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex+1]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex+18]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex+19]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex+20]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex-18]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex-19]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex-20])),this.gMove=function(t,i){rec=g(this.hero.hitbox),rec.x+=t,rec.y+=i,amount=0;for(var e=1;e<this.speed;e++){canMove=!0;for(var s=0;s<this.hero.collisionArray.length;s++)if(tile=this.hero.collisionArray[s],tile.entity.isSolid&&L(tile.entity.hitbox,rec)){canMove=!1;break}canMove&&amount++}return amount},R(i),this.level.draw(this.hero,t),gradient=ctx.createLinearGradient(0,0,D,0),gradient.addColorStop("0","#"+Q),gradient.addColorStop(".5","#"+J),ctx.fillStyle=gradient,ctx.font="italic 40px Arial",ctx.fillText("SCORE "+tt,900,50),U=!1,this.hero.update(t),nt.canvas.style.cursor="none";let e=Y.x,s=Y.y;nt.context.globalCompositeOperation="difference",nt.context.fillStyle="WHITE",nt.context.fillRect(e-2,s-15,4,30),nt.context.fillRect(e-15,s-2,30,4),nt.context.globalCompositeOperation="source-over"},this.reset=function(){z=!1,$=!1,this.hero=new O(16,16,D/2,H/2,0,c.HERO,"",this.scale,xOffset,yOffset),this.hero.sx=16,this.level=new I(D,H,0),this.level.reset(this.hero,this.scale)}}var _,C,W,M,E=!1,D=1216,H=832,B=!1,G=!0,P=0,K=Date.now(),F=Date.now(),X=0,Y=new A(0,0),N=new A(0,0),U=!1,V=1.346,q=1.38,z=!1,J="990099",Q="05f2db",Z=300,$=!1,tt=0,it=new Image;it.src="atlas.png";var et=new S;l(),h=!1;var st=!1,ht=!1;function startGame(){nt.start()}var nt={canvas:document.createElement("canvas"),start:function(){this.canvas.width=D,this.canvas.height=H,this.context=this.canvas.getContext("2d"),this.context.scale(1,1),this.context.mozImageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.context.imageSmoothingEnabled=!1,this.canvas.classList.add("screen"),document.body.insertBefore(this.canvas,document.body.childNodes[6]),this.frameNo=0,this.interval=setInterval(ot,20),window.addEventListener("keydown",function(t){t.preventDefault(),nt.keys=nt.keys||[],nt.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("keyup",function(t){nt.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("mousedown",function(t){t.preventDefault(),nt.keys=nt.keys||[],nt.keys[t.button]=!0}),window.addEventListener("mouseup",function(t){t.preventDefault(),nt.keys=nt.keys||[],nt.keys[t.button]=!1,N.set(Y.x,Y.y),W=Math.floor(N.y/64),M=Math.floor(N.x/64),_=M+19*W,U=!0,st||ht||(st=!0)}),window.addEventListener("mousemove",function(t){t.preventDefault();var i=nt.canvas.getBoundingClientRect();Y.set((t.clientX-i.left)*V,(t.clientY-i.top)*q),row=Math.floor(Y.y/64),col=Math.floor(Y.x/64),C=col+19*row}),this.canvas.oncontextmenu=function(t){t.preventDefault()}},stop:function(){clearInterval(this.interval)},clear:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}};function ot(){st&&h&&(e.play(),e.loop=!0,st=!1,B=!0),K=F,F=Date.now(),X+=P=F-K,B?(nt.clear(),et.update(P/1e3,X)):(nt.clear(),ctx=nt.context,ctx.save(),ctx.globalAlpha=.3,ctx.fillStyle="#"+J,ctx.fillRect(75,75,1070,680),ctx.globalAlpha=1,ctx.font="italic 90px Arial",ctx.fillStyle="WHITE",ctx.fillText("-- CLICK TO START --",180,400),ctx.font="italic 50px Arial",ctx.fillText("JS13K 2021 - Theme SPACE",200,200),ctx.fillText("@CarelessLabs",200,700),R(X),ctx.restore())}function rt(){return nt.keys&&(nt.keys[xt]||nt.keys[vt])}function lt(){return nt.keys&&(nt.keys[dt]||nt.keys[gt])}function ct(){return nt.keys&&(nt.keys[yt]||nt.keys[wt])}function at(){return nt.keys&&(nt.keys[pt]||nt.keys[bt])}function ft(){return nt.keys&&nt.keys[Lt]}function ut(){return nt.keys&&nt.keys[At]}var xt=37,dt=39,yt=38,pt=40,wt=87,vt=65,bt=83,gt=68,Tt=0,mt=2,Lt=32,At=49,Rt=50,kt=51,It=52;function Ot(t,i,e,s,h,n){this.entity=new O(t,i,e,s,0,n,h,4,hitboxOffsetX=0,hitboxOffsetY=0,!0),this.action=n,this.update=function(){this.entity.update()},this.tick=function(t){},this.processAction=function(){et.menu.curItm=this.action,this.action,a.UP}}function St(e){for(this.scale=e,this.menu=new O(48,H,D-48,H/2,0,c.BOX,"#cc00cc",this.scale,0,0),this.menu.image=null,this.menu.alpha=.4,this.buttons=[],this.curItm=null,this.nButtons=10,this.canBuild=!1,this.hoverTile,i=0;i<this.nButtons;i++)this.buttons.push(new Ot(32,32,D-48,50+80*i,"#131a2d",k(a,i)));this.update=function(){for(this.menu.update(),i=0;i<this.nButtons;i++)b=this.buttons[i],b.update(),m(Y.x,Y.y,32,32,b.entity.x,b.entity.y,b.entity.width,b.entity.height)?b.entity.hover=!0:b.entity.hover=!1},this.checkBuild=function(){if(this.canBuild=!1,this.hoverTile=p(C,et.level),null!=this.hoverTile&&this.hoverTile.isFloor()||null!=this.hoverTile&&this.curItm==a.PC&&this.hoverTile.isTable())switch(this.curItm){case a.CHAIR:tt>CHAIRPRICE&&(this.canBuild=!0)}},this.tick=function(){clickRec=new T(N,10,10);for(var t=0;t<this.buttons.length;t++)if(b=this.buttons[t],L(b.entity.hitbox,clickRec))return b.processAction(),!1;return!0},this.processBuilding=function(i,e,s){if(i&&(i=!1,ci=_,t=p(ci,e),null!=t)){switch(ta=p(ci-19,e),taa=p(ci-38,e),tb=p(ci+19,e),tbb=p(ci+38,e),this.curItm){case a.CHAIR:break;default:console.log("processBuilding NAN")}t.change()}}}function _t(){function t(t){return t>=1}this.percent=0,this.startAngle=1.5*Math.PI,this.endAngle=-.5*Math.PI+this.percent*Math.PI*2,this.colour1="silver",this.colour2=v(),this.resetChance=RESETCHANCE,this.happy=w(2,5),this.mHappy=!0,this.speed=8e3,this.minSpeed=8e3,this.maxSpeed=3e3,this.exit=!1,this.fourfour=!1,this.delivered=!1,this.waiting=!1,this.draw=function(i,e){ctx=nt.context,this.endAngle=-.5*Math.PI+this.percent*Math.PI*2,ctx.lineWidth=10,t(this.percent)?(this.waiting=!1,this.mHappy&&!this.delivered&&(this.fourfour=!0,this.happy--,this.mHappy=!1,0==this.happy&&(this.exit=!0))):(this.waiting=!0,this.mHappy=!0,ctx.beginPath(),ctx.arc(i,e,10,this.startAngle,this.endAngle),ctx.strokeStyle=this.colour1,ctx.stroke(),ctx.beginPath(),ctx.arc(i,e,10,this.endAngle,-.5*Math.PI),ctx.strokeStyle=this.colour2,ctx.stroke(),ctx.restore())},this.tick=function(i){t(this.percent)||(this.percent+=i/this.speed)},this.reset=function(){t(this.percent)&&this.resetChance>w(0,100)&&(this.percent=0,this.speed=w(this.maxSpeed,this.minSpeed))}}function Ct(){this.ammo=AMMOSTART,this.bullets=[],this.addBullets=function(t,i,e,s){this.ammo>0&&(this.bullets.push(new Wt(t,i,e,s)),this.ammo--)},this.drawBullets=function(t,e){for(i=0;i<this.bullets.length;i++){this.bullets[i].draw(t,e)}this.bullets=this.bullets.filter(function(t){return 1==t.active})}}function Wt(t,i,e,s){this.id=BID++,this.scale=4,this.speed=Z,this.w=50,this.h=50,this.mhWidth=this.w/-2,this.mhHeight=this.h/-2,this.dst=0,this.active=!0,this.hitbox=new d(t,i,this.w,this.h),this.colour="#a205a2",this.dist=0,this.v=new A(t+10,i+10),this.dx=e-t,this.dy=s-i,this.length=Math.sqrt(this.dx*this.dx+this.dy*this.dy),this.dx=this.dx/this.length,this.dy=this.dy/this.length,this.draw=function(t,i){if(this.active){for(xx=this.v.x,yy=this.v.y,this.v.x+=this.dx*t*this.speed,this.v.y+=this.dy*t*this.speed,this.dist+=Math.sqrt((this.v.x-xx)*(this.v.x-xx)+(this.v.y-yy)*(this.v.y-yy)),(this.v.x<0||this.v.x>1300||this.v.y<0||this.v.y>840||this.dist>SHOOTDIST)&&(this.active=!1),this.hitbox.x=this.v.x+this.mhWidth,this.hitbox.y=this.v.y+this.mhHeight,j=0;j<i.length;j++)pc=i[j],person=pc.getPerson(),null!=person&&L(pc.hitbox,this.hitbox)&&null!=person.progress&&person.progress.percent<1&&(person.progress.percent=1,person.progress.happy<5&&(person.progress.happy+=2),person.progress.delivered=!0,person.progress.mHappy=!1,tt+=DELIVERED,targets[pc.id]=!1,this.active=!1,et.hero.showTextY=-5,et.hero.showTextTime=HEROTEXTTIME,et.hero.showText="+ S"+DELIVERED);ctx=nt.context,ctx.save(),ctx.translate(this.v.x,this.v.y),ctx.fillStyle=this.colour,ctx.fillRect(.5*this.mhWidth,.5*this.mhHeight,.5*this.w,.5*this.h),ctx.restore()}}}