const t={WALL:"WALL",HERO:"HERO"};function h(t,e,i){this.numberFrames=t,this.frameDuration=e,this.loop=i,this.timeElapsed=0,this.currentFrame=0,this.pauseAnimation=!1,this.getKeyFrame=function(t){this.timeElapsed+=t,this.currentFrame=Math.floor(this.timeElapsed/this.frameDuration),this.currentFrame=this.currentFrame%this.numberFrames}}function n(e,i,s,h,n,a,o){this.entity=new d(e,e,i,s,t.WALL,"BLACK",4,hitboxOffsetX=0,hitboxOffsetY=0,image="assets/images/tile.png"),this.entity.alpha=.4,this.isSolid=n,this.column=a,this.row=o,this.type=h,this.active=!0,this.update=function(){this.entity.update()},this.tick=function(t){}}function a(t){return"object"==typeof t?t.pressed:1==t}function o(t,e,i,s){this.x=t,this.y=e,this.w=i,this.h=s}function c(t,e,i,s,h,n,a,o){return t<h+a&&t+i>h&&e<n+o&&e+s>n}function c(t,e){return t.x<e.x+e.w&&t.x+t.w>e.x&&t.y<e.y+e.h&&t.y+t.h>e.y}function l(t,e){this.x=t,this.y=e,this.set=function(t,e){this.x=t,this.y=e}}function r(e,s,h){this.tiles=[],this.backTiles=[],this.startX=0,this.startY=0,this.canvasHalfW=e/2,this.canvasHalfH=s/2,this.levels=[],this.active=!1,this.complete=!1,this.maxLevels;this.draw=function(t){for(i=0;i<this.backTiles.length;i++){this.backTiles[i].update()}for(i=0;i<this.tiles.length;i++){this.tiles[i].update()}},this.tick=function(t){for(i=0;i<this.tiles.length;i++){this.tiles[i].tick(t)}},this.reset=function(e,i){var s=null!=e?e.currentLevel:0;this.tiles=[],this.backTiles=[],this.levels[s];for(row=0;row<13;row++)for(col=0;col<19;col++){var h;xx=16*col*i,yy=16*row*i;var a=t.WALL;0==row||0==col||12==row||18==col?((h=new n(16,xx,yy,a,!1,col,row)).entity.active=!1,this.tiles.push(h)):(h=new n(16,xx,yy,a,!1,col,row),this.tiles.push(h))}}}function d(t,e,i,s,h,n,a,c=0,l=0,r=""){this.scale=a,this.type=h,this.width=t,this.height=e,this.mhWidth=t/-2,this.mhHeight=e/-2,this.mhWidthScaled=t/-2*a,this.mhHeightScaled=e/-2*a,this.hWidth=t/2,this.hHeight=e/2,this.yOffset=0,this.angle=0,this.x=i,this.y=s,this.active=!0,this.colour=n,this.image=new Image,this.image.src=r,this.animated=!1,this.anination=null,this.hitboxOffsetX=c,this.hitboxOffsetY=l,this.alpha=1,this.setHitbox=function(){this.hitbox=new o(0,0,0,0),this.hitbox.x=this.x+this.mhWidthScaled+this.hitboxOffsetX*this.scale,this.hitbox.y=this.y+this.mhHeightScaled+this.hitboxOffsetY*this.scale,this.hitbox.w=this.width*this.scale-this.hitboxOffsetX*this.scale,this.hitbox.h=this.height*this.scale-this.hitboxOffsetY*this.scale},this.setHitbox(),this.updateHitbox=function(){this.hitbox.x=this.x+this.mhWidthScaled+this.hitboxOffsetX*this.scale,this.hitbox.y=this.y+this.mhHeightScaled+this.hitboxOffsetY*this.scale},this.update=function(t){this.updateHitbox(),this.active&&(this.hitbox.x=this.x+this.mhWidth*this.scale,this.hitbox.y=this.y+this.mhHeight*this.scale,ctx=G.context,ctx.save(),ctx.translate(this.x,this.y),ctx.rotate(this.angle),this.animated?(this.animation.pauseAnimation||this.animation.getKeyFrame(t),ctx.drawImage(this.image,this.width*this.animation.currentFrame,0,this.width,this.height,0,0,this.width*this.scale,this.height*this.scale)):null==this.image?(ctx.fillStyle=this.colour,ctx.fillRect(.5*this.mhWidth*this.scale,.5*this.mhHeight*this.scale,.5*this.width*this.scale,.5*this.height*this.scale)):(ctx.globalAlpha=this.alpha,ctx.drawImage(this.image,0,0,this.width,this.height,0,0,this.width*this.scale,this.height*this.scale)),ctx.restore())}}function f(){xOffset=5,yOffset=5,this.scale=4,this.hero=new d(30,30,w/2,b/2,t.HERO,"red",this.scale,xOffset,yOffset),this.hero.image.src="assets/images/square.png",this.entities=[],this.speed=5,this.level=new r(w,b,0),this.hero.currentLevel=0,this.level.reset(this.hero,this.scale),this.update=function(i,h){p=navigator.getGamepads(),I()&&(this.hero.x-=this.speed),C()&&(this.hero.x+=this.speed),X()&&(this.hero.y-=this.speed),Y()&&(this.hero.y+=this.speed),T(),G.context.fillStyle="#FFF";for(let t=2e3;t--;)x=(1e9*Math.sin(t)-h/2e3*(t+1e3)/50)%(G.canvas.width+9)-9,y=9*t%G.canvas.height,s=t%5,G.context.fillRect(x,y,s,s);for(d in this.level.tick(this.hero),this.level.draw(this.hero),this.entities)e=this.entities[d],e.type,t.WALL,e.update(i);F&&(F=!1,console.log(u),this.level.tiles[u].entity.active=!1),this.hero.update(i),G.canvas.style.cursor="none";let n=W.x,a=W.y;G.context.globalCompositeOperation="difference",G.context.fillStyle="WHITE",G.context.fillRect(n-2,a-15,4,30),G.context.fillRect(n-15,a-2,30,4),G.context.globalCompositeOperation="source-over"}}var u,m,g,v=!1,p=[],w=1216,b=832,k=!1,L=0,O=Date.now(),H=Date.now(),E=0,W=new l(0,0),S=new l(0,0),F=!1,D=1.33,A=new f;function startGame(){G.start()}var G={canvas:document.createElement("canvas"),start:function(){this.canvas.width=w,this.canvas.height=b,this.context=this.canvas.getContext("2d"),this.context.scale(1,1),this.context.mozImageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.context.imageSmoothingEnabled=!1,this.canvas.classList.add("screen"),document.body.insertBefore(this.canvas,document.body.childNodes[6]),this.frameNo=0,this.interval=setInterval(R,20),window.addEventListener("keydown",function(t){t.preventDefault(),G.keys=G.keys||[],G.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("keyup",function(t){G.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("mousedown",function(t){t.preventDefault(),G.keys=G.keys||[],G.keys[t.button]=!0}),window.addEventListener("mouseup",function(t){t.preventDefault(),G.keys=G.keys||[],G.keys[t.button]=!1,S.set(W.x,W.y),m=Math.floor(S.y/64),g=Math.floor(S.x/64),u=g+19*m,F=!0}),window.addEventListener("mousemove",function(t){t.preventDefault();var e=G.canvas.getBoundingClientRect();W.set((t.clientX-e.left)*D,(t.clientY-e.top)*D)}),this.canvas.oncontextmenu=function(t){t.preventDefault()},window.addEventListener("gamepadconnected",function(t){var e=navigator.getGamepads()[t.gamepad.index];console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",e.index,e.id,e.buttons.length,e.axes.length)})},stop:function(){clearInterval(this.interval)},clear:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}};function R(){O=H,H=Date.now(),E+=L=H-O,navigator.getGamepads?navigator.getGamepads():!navigator.webkitGetGamepads||navigator.webkitGetGamepads,k?G.clear():(G.clear(),A.update(L/1e3,E))}function I(){return G.keys&&(G.keys[M]||G.keys[q])}function C(){return G.keys&&(G.keys[B]||G.keys[J])}function X(){return G.keys&&(G.keys[K]||G.keys[j])}function Y(){return G.keys&&(G.keys[N]||G.keys[z])}function T(){return G.keys&&G.keys[U]}var M=37,B=39,K=38,N=40,j=87,q=65,z=83,J=68,P=0,Q=2,U=32,V=49,Z=50,$=51,_=52;