const t={WALL_R:"WALL_L",WALL_L:"WALL_R",WALL_T:"WALL_T",WALL_T:"WALL_B",WALL_RT:"WALL_RT",WALL_LT:"WALL_LT",WALL_BR:"WALL_BR",WALL_BL:"WALL_BL",FLOOR:"FLOOR",AIR:"AIR",HERO:"HERO"};function h(t,i,e){this.numberFrames=t,this.frameDuration=i,this.loop=e,this.timeElapsed=0,this.currentFrame=0,this.pauseAnimation=!1,this.getKeyFrame=function(t){this.timeElapsed+=t,this.currentFrame=Math.floor(this.timeElapsed/this.frameDuration),this.currentFrame=this.currentFrame%this.numberFrames}}function n(t,i,e,s,h,n,a,o){this.entity=new d(t,t,i,e,s,h,"BLACK",4,hitboxOffsetX=0,hitboxOffsetY=0,image="atlas.png"),this.isSolid=n,this.column=a,this.row=o,this.type=h,this.active=!0,this.update=function(){this.entity.update()},this.tick=function(t){}}function a(t){return"object"==typeof t?t.pressed:1==t}function o(t,i,e,s){this.x=t,this.y=i,this.w=e,this.h=s}function c(t,i,e,s,h,n,a,o){return t<h+a&&t+e>h&&i<n+o&&i+s>n}function c(t,i){return t.x<i.x+i.w&&t.x+t.w>i.x&&t.y<i.y+i.h&&t.y+t.h>i.y}function l(t,i){this.x=t,this.y=i,this.set=function(t,i){this.x=t,this.y=i}}function r(e,s,h){this.tiles=[],this.backTiles=[],this.startX=0,this.startY=0,this.canvasHalfW=e/2,this.canvasHalfH=s/2,this.levels=[],this.active=!1,this.complete=!1,this.maxLevels;this.draw=function(t){for(i=0;i<this.backTiles.length;i++){this.backTiles[i].update()}for(i=0;i<this.tiles.length;i++){this.tiles[i].update()}},this.tick=function(t){for(i=0;i<this.tiles.length;i++){this.tiles[i].tick(t)}},this.reset=function(i,e){var s=null!=i?i.currentLevel:0;this.tiles=[],this.backTiles=[],this.levels[s];for(row=0;row<13;row++)for(col=0;col<19;col++){var h;xx=16*col*e,yy=16*row*e;var a=t.WALL;a=0==row||0==col||12==row||18==col?t.AIR:1==row&&1==col?t.WALL_RT:1==row&&col>1&&col<17?t.WALL_T:1==row&&17==col?t.WALL_LT:11==row&&17==col?t.WALL_BR:11==row&&1==col?t.WALL_BL:11==row&&col>1&&col<17?t.WALL_B:17==col?t.WALL_R:1==col?t.WALL_L:t.FLOOR,h=new n(16,xx,yy,0,a,!1,col,row),this.tiles.push(h)}}}function d(i,e,s,h,n,a,c,l,r=0,d=0,f=""){this.scale=l,this.type=a,this.width=i,this.height=e,this.mhWidth=i/-2,this.mhHeight=e/-2,this.mhWidthScaled=i/-2*l,this.mhHeightScaled=e/-2*l,this.hWidth=i/2,this.hHeight=e/2,this.yOffset=0,this.angle=n,this.x=s,this.y=h,this.active=!0,this.colour=c,this.image=new Image,this.image.src=f,this.animated=!1,this.anination=null,this.hitboxOffsetX=r,this.hitboxOffsetY=d,this.alpha=1,this.sx=0,this.sy=0,this.type==t.WALL_R?this.sx=80:this.type==t.WALL_RT?this.sx=128:this.type==t.WALL_LT?(this.sx=16,this.sy=16):this.type==t.WALL_L?this.sx=64:this.type==t.WALL_T?this.sy=16:this.type==t.WALL_B?this.sx=112:this.type==t.WALL_BR?(this.sx=32,this.sy=16):this.type==t.WALL_BL?(this.sx=48,this.sy=16):this.type==t.FLOOR?(this.sx=48,this.alpha=.4):this.type==t.AIR&&(this.sx=144),this.setHitbox=function(){this.hitbox=new o(0,0,0,0),this.hitbox.x=this.x+this.mhWidthScaled+this.hitboxOffsetX*this.scale,this.hitbox.y=this.y+this.mhHeightScaled+this.hitboxOffsetY*this.scale,this.hitbox.w=this.width*this.scale-this.hitboxOffsetX*this.scale,this.hitbox.h=this.height*this.scale-this.hitboxOffsetY*this.scale},this.setHitbox(),this.updateHitbox=function(){this.hitbox.x=this.x+this.mhWidthScaled+this.hitboxOffsetX*this.scale,this.hitbox.y=this.y+this.mhHeightScaled+this.hitboxOffsetY*this.scale},this.update=function(t){this.updateHitbox(),this.active&&(this.hitbox.x=this.x+this.mhWidth*this.scale,this.hitbox.y=this.y+this.mhHeight*this.scale,ctx=F.context,ctx.save(),ctx.translate(this.x,this.y),this.animated?(this.animation.pauseAnimation||this.animation.getKeyFrame(t),ctx.drawImage(this.image,this.width*this.animation.currentFrame,0,this.width,this.height,0,0,this.width*this.scale,this.height*this.scale)):null==this.image?(ctx.fillStyle=this.colour,ctx.fillRect(.5*this.mhWidth*this.scale,.5*this.mhHeight*this.scale,.5*this.width*this.scale,.5*this.height*this.scale)):(ctx.globalAlpha=this.alpha,ctx.drawImage(this.image,this.sx,this.sy,this.width,this.height,0,0,this.width*this.scale,this.height*this.scale)),ctx.restore())}}function f(){xOffset=5,yOffset=5,this.scale=4,this.hero=new d(10,10,g/2,v/2,0,t.HERO,"red",this.scale,xOffset,yOffset),this.hero.image.src="atlas.png",this.hero.sx=16,this.entities=[],this.speed=5,this.level=new r(g,v,0),this.hero.currentLevel=0,this.level.reset(this.hero,this.scale),this.update=function(i,h){w=navigator.getGamepads(),S()&&(this.hero.x-=this.speed),I()&&(this.hero.x+=this.speed),D()&&(this.hero.y-=this.speed),G()&&(this.hero.y+=this.speed),C(),F.context.fillStyle="#FFF";for(let t=2e3;t--;)x=(1e9*Math.sin(t)-h/2e3*(t+1e3)/50)%(F.canvas.width+9)-9,y=9*t%F.canvas.height,s=t%5,F.context.fillRect(x,y,s,s);for(d in this.level.tick(this.hero),this.level.draw(this.hero),this.entities)e=this.entities[d],e.type,t.WALL,e.update(i);H&&(H=!1,console.log(u),this.level.tiles[u].entity.active=!1),this.hero.update(i),F.canvas.style.cursor="none";let n=R.x,a=R.y;F.context.globalCompositeOperation="difference",F.context.fillStyle="WHITE",F.context.fillRect(n-2,a-15,4,30),F.context.fillRect(n-15,a-2,30,4),F.context.globalCompositeOperation="source-over"}}var u,L,m,p=!1,w=[],g=1216,v=832,b=!1,W=0,A=Date.now(),k=Date.now(),_=0,R=new l(0,0),O=new l(0,0),H=!1,T=1.33,E=new f;function startGame(){F.start()}var F={canvas:document.createElement("canvas"),start:function(){this.canvas.width=g,this.canvas.height=v,this.context=this.canvas.getContext("2d"),this.context.scale(1,1),this.context.mozImageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.context.imageSmoothingEnabled=!1,this.canvas.classList.add("screen"),document.body.insertBefore(this.canvas,document.body.childNodes[6]),this.frameNo=0,this.interval=setInterval(B,20),window.addEventListener("keydown",function(t){t.preventDefault(),F.keys=F.keys||[],F.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("keyup",function(t){F.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("mousedown",function(t){t.preventDefault(),F.keys=F.keys||[],F.keys[t.button]=!0}),window.addEventListener("mouseup",function(t){t.preventDefault(),F.keys=F.keys||[],F.keys[t.button]=!1,O.set(R.x,R.y),L=Math.floor(O.y/64),m=Math.floor(O.x/64),u=m+19*L,H=!0}),window.addEventListener("mousemove",function(t){t.preventDefault();var i=F.canvas.getBoundingClientRect();R.set((t.clientX-i.left)*T,(t.clientY-i.top)*T)}),this.canvas.oncontextmenu=function(t){t.preventDefault()},window.addEventListener("gamepadconnected",function(t){var i=navigator.getGamepads()[t.gamepad.index];console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",i.index,i.id,i.buttons.length,i.axes.length)})},stop:function(){clearInterval(this.interval)},clear:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}};function B(){A=k,k=Date.now(),_+=W=k-A,navigator.getGamepads?navigator.getGamepads():!navigator.webkitGetGamepads||navigator.webkitGetGamepads,b?F.clear():(F.clear(),E.update(W/1e3,_))}function S(){return F.keys&&(F.keys[X]||F.keys[j])}function I(){return F.keys&&(F.keys[Y]||F.keys[q])}function D(){return F.keys&&(F.keys[M]||F.keys[N])}function G(){return F.keys&&(F.keys[K]||F.keys[z])}function C(){return F.keys&&F.keys[Q]}var X=37,Y=39,M=38,K=40,N=87,j=65,z=83,q=68,J=0,P=2,Q=32,U=49,V=50,Z=51,$=52;