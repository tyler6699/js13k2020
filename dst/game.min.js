var e,h=!1,n=!1,r={songData:[{i:[1,15,164,0,1,15,117,15,0,15,0,28,87,0,0,0,64,1,1,2,38,128,1,3,255,2,212,8],p:[1,1,2,2,3,1,2,3,1,1],c:[{n:[137,149,152,149,151,152],f:[]},{n:[135,137,154,125,146,154],f:[]},{n:[135,147,142,149,147,140,,,,,,,161,156,151,135,,,,,,,,,145,157,138,150],f:[]}]},{i:[0,105,128,0,0,255,128,33,0,7,7,20,39,0,0,0,0,0,0,2,41,0,0,8,0,6,0,0],p:[1,1,1,1,1,1,1,1,1,2],c:[{n:[,,,99,,,99,,,,,,,,,111,,,,99,,,99],f:[]},{n:[],f:[]}]},{i:[1,12,128,0,1,12,112,0,0,0,75,6,0,0,0,0,243,10,1,2,135,0,0,3,147,6,230,4],p:[,,,,,4],c:[{n:[137],f:[]},{n:[,,134],f:[]},{n:[159],f:[]},{n:[157],f:[]}]}],rowLen:6615,patternLen:32,endPattern:9,numChannels:3},o=function(){var t,i,e,s,h,n=function(t){return Math.sin(6.283184*t)},r=function(t){return.003959503758*Math.pow(2,(t-128)/12)},o=function(t,i,e){var s,h,n,o,c,l,u,p=a[t.i[0]],d=t.i[1],x=t.i[3],f=a[t.i[4]],y=t.i[5],m=t.i[8],g=t.i[9],w=t.i[10]*t.i[10]*4,v=t.i[11]*t.i[11]*4,b=t.i[12]*t.i[12]*4,T=1/b,A=t.i[13],L=e*Math.pow(2,2-t.i[14]),k=new Int32Array(w+v+b),C=0,I=0;for(s=0,h=0;s<w+v+b;s++,h++)h>=0&&(h-=L,l=r(i+(15&(A=A>>8|(255&A)<<4))+t.i[2]-128),u=r(i+(15&A)+t.i[6]-128)*(1+8e-4*t.i[7])),n=1,s<w?n=s/w:s>=w+v&&(n-=(s-w-v)*T),o=l,x&&(o*=n*n),c=p(C+=o)*d,o=u,m&&(o*=n*n),c+=f(I+=o)*y,g&&(c+=(2*Math.random()-1)*g),k[s]=80*c*n|0;return k},a=[n,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var i=t%1*4;return i<2?i-1:3-i}];this.init=function(n){t=n,i=n.endPattern,e=0,s=n.rowLen*n.patternLen*(i+1)*2,h=new Int32Array(s)},this.generate=function(){var r,c,l,u,p,d,x,f,y,m,g,w,v,b,T=new Int32Array(s),A=t.songData[e],L=t.rowLen,k=t.patternLen,C=0,I=0,R=!1,B=[];for(l=0;l<=i;++l)for(x=A.p[l],u=0;u<k;++u){var S=x?A.c[x-1].f[u]:0;S&&(A.i[S-1]=A.c[x-1].f[u+k]||0,S<16&&(B=[]));var O=a[A.i[15]],E=A.i[16]/512,H=Math.pow(2,A.i[17]-9)/L,P=A.i[18],W=A.i[19],_=43.23529*A.i[20]*3.141592/44100,M=1-A.i[21]/255,D=1e-5*A.i[22],F=A.i[23]/32,U=A.i[24]/512,N=6.283184*Math.pow(2,A.i[25]-9)/L,$=A.i[26]/255,G=A.i[27]*L&-2;for(g=(l*k+u)*L,p=0;p<4;++p)if(d=x?A.c[x-1].n[u+p*k]:0){B[d]||(B[d]=o(A,d,L));var Y=B[d];for(c=0,r=2*g;c<Y.length;c++,r+=2)T[r]+=Y[c]}for(c=0;c<L;c++)(m=T[f=2*(g+c)])||R?(w=_,P&&(w*=O(H*f)*E+.5),I+=(w=1.5*Math.sin(w))*(v=M*(m-I)-(C+=w*I)),m=3==W?I:1==W?v:C,D&&(m=(m*=D)<1?m>-1?n(.25*m):-1:1,m/=D),R=(m*=F)*m>1e-5,b=m*(1-(y=Math.sin(N*f)*U+.5)),m*=y):b=0,f>=G&&(b+=T[f-G+1]*$,m+=T[f-G]*$),T[f]=0|b,T[f+1]=0|m,h[f]+=0|b,h[f+1]+=0|m}return++e/t.numChannels},this.createWave=function(){var t=44+2*s-8,i=t-36,e=new Uint8Array(44+2*s);e.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&i,i>>8&255,i>>16&255,i>>24&255]);for(var n=0,r=44;n<s;++n){var o=h[n];o=o<-32767?-32767:o>32767?32767:o,e[r++]=255&o,e[r++]=o>>8&255}return e},this.getData=function(t,i){for(var e=2*Math.floor(44100*t),s=new Array(i),n=0;n<2*i;n+=1){var r=e+n;s[n]=t>0&&r<h.length?h[r]/32768:0}return s}};function a(){var t=new o;t.init(r),setInterval(function(){if(!h&&(h=t.generate()>=1)){var i=t.createWave();(e=document.createElement("audio")).src=URL.createObjectURL(new Blob([i],{type:"audio/wav"})),n=!0}},0)}const c={WALL_R:0,WALL_L:1,WALL_T:2,WALL_B:3,WALL_RT:4,WALL_LT:5,WALL_BR:6,WALL_BL:7,FLOOR:8,AIR:9,HERO:10,TABLE:11,CHAIR_T:12,CHAIR_B:13,PC:14,PC_B:15,BOX:16,SERVER:17,PERSON:18,VEND:19,AUTO:20},l={GUN:0,DESK:1,CHAIR:2,PC:3,SERVER:4,VEND:5,AUTO:6,UP:21};function u(t,i,e){this.numberFrames=t,this.frameDuration=i,this.loop=e,this.timeElapsed=0,this.currentFrame=0,this.pauseAnimation=!1,this.getKeyFrame=function(t){this.timeElapsed+=t,this.currentFrame=Math.floor(this.timeElapsed/this.frameDuration),this.currentFrame=this.currentFrame%this.numberFrames}}function p(t,i,e,s,h,n,r,o){this.entity=new H(t,t,i,e,s,h,"BLACK",4,hitboxOffsetX=0,hitboxOffsetY=0,image="atlas.png"),this.entity.setType(),this.column=r,this.row=o,this.active=!0,this.update=function(t){this.entity.update(t),null!=this.person()&&this.entity.person.tick()},this.tick=function(t){},this.change=function(){this.entity.type>=Object.values(c).length&&(this.entity.type=0),this.entity.setType()},this.isTable=function(){return this.entity.isTable()},this.isChairB=function(){return this.entity.isChairB()},this.isChairT=function(){return this.entity.isChairT()},this.isFloor=function(){return this.entity.isFloor()},this.person=function(){return this.entity.person}}function d(t){Bt.hero.showTextY=-15,Bt.hero.showTextTime=ct/2,Bt.hero.showText=t}function f(t,i,e,s){this.x=t,this.y=i,this.w=e,this.h=s}function m(t,i){return i.tiles[t]}function g(t,i){return Math.floor(Math.random()*(i-t+1)+t)}function w(){for(var t="#",i=0;i<6;i++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t}function v(t){return new f(t.x,t.y,t.w,t.h)}function T(t,i,e){return new f(t.x,t.y,i,e)}function A(t,i,e,s,h,n,r,o){return t<h+r&&t+e>h&&i<n+o&&i+s>n}function L(t,i){return t.x<i.x+i.w&&t.x+t.w>i.x&&t.y<i.y+i.h&&t.y+t.h>i.y}function k(t,i){this.x=t,this.y=i,this.set=function(t,i){this.x=t,this.y=i}}function C(t){Ht.context.fillStyle="#FFF";for(let i=2e3;i--;)x=(1e9*Math.sin(i)-t/2e3*(i+1e3)/50)%(Ht.canvas.width+9)-9,y=9*i%Ht.canvas.height,s=i%5,Ht.context.fillRect(x,y,s,s)}function I(t,i){return Object.values(t)[i]}function R(t){return Object.keys(t)}function B(t){return R(t).map(function(i){return t[i]})}function S(t,i){return t[R(t).filter(function(t){return i===t}).pop()||""]}function O(t,i){return R(t).filter(function(e){return t[e]===i}).pop()||null}function E(t,e,s){this.tiles=[],this.backTiles=[],this.startX=0,this.startY=0,this.canvasHalfW=t/2,this.canvasHalfH=e/2,this.levels=[],this.active=!1,this.complete=!1,this.maxLevels;this.draw=function(t,e){for(i=0;i<this.backTiles.length;i++){this.backTiles[i].update(e)}for(i=0;i<this.tiles.length;i++){this.tiles[i].update(e)}},this.tick=function(t){for(i=0;i<this.tiles.length;i++){this.tiles[i].tick(t,G)}},this.reset=function(t,i){var e=null!=t?t.currentLevel:0;this.tiles=[],this.backTiles=[],this.levels[e];for(row=0;row<13;row++)for(col=0;col<19;col++){var s;xx=16*col*i,yy=16*row*i;var h=c.WALL;h=0==row||0==col||12==row||18==col?c.AIR:1==row&&1==col?c.WALL_RT:1==row&&col>1&&col<17?c.WALL_T:1==row&&17==col?c.WALL_LT:11==row&&17==col?c.WALL_BR:11==row&&1==col?c.WALL_BL:11==row&&col>1&&col<17?c.WALL_B:17==col?c.WALL_R:1==col?c.WALL_L:c.FLOOR,s=new p(16,xx,yy,0,h,!1,col,row),this.tiles.push(s)}}}function H(t,i,e,s,h,n,r,o,a=0,u=0,p="",d=!1){this.scale=o,this.type=n,this.width=t,this.height=i,this.mhWidth=t/-2,this.mhHeight=i/-2,this.mhWidthScaled=t/-2*o,this.mhHeightScaled=i/-2*o,this.hWidth=t/2,this.hHeight=i/2,this.yOffset=0,this.yDrawOffset=0,this.angle=h,this.x=e,this.y=s,this.active=!0,this.colour=r,this.image=new Image,this.image.src=p,this.animated=!1,this.anination=null,this.hitboxOffsetX=a,this.hitboxOffsetY=u,this.alpha=1,this.currentTile=0,this.collisionArray=[],this.isSolid=!1,this.isButton=d,this.drawTile=!1,this.pc=null,this.person=null,this.gun=null,this.ammo=5,this.time=0,this.showText="",this.showTextTime=0,this.showTextY=0,this.currentGift=0,this.shootTime=0,this.hover=!1,this.hoverText="",this.hoverText2="",this.sx=0,this.sy=0,this.setHitbox=function(){this.hitbox=new f(0,0,0,0),this.sensor=new f(0,0,0,0),this.isButton&&(this.hitbox.w=2*this.width,this.hitbox.h=2*this.height)},this.setHitbox(),this.updateHitbox=function(){this.isButton?(this.hitbox.x=this.x-this.width,this.hitbox.y=this.y-this.height):(this.hitbox.x=this.x+this.hitboxOffsetX*this.scale/2,this.hitbox.y=this.y+this.hitboxOffsetX*this.scale/2,this.hitbox.w=this.width*this.scale-this.hitboxOffsetX*this.scale,this.hitbox.h=this.height*this.scale-this.hitboxOffsetY*this.scale,this.sensor.x=this.x-5,this.sensor.y=this.y-5,this.sensor.w=this.width*this.scale+10,this.sensor.h=this.height*this.scale+10)},this.addPC=function(t,i,e){null==this.pc?this.pc=new ii(t,i,e):this.pc.direction=t},this.update=function(t){if(this.updateHitbox(),this.active){if(ctx=Ht.context,ctx.save(),ctx.translate(this.x,this.y),this.drawTile&&(ctx.globalAlpha=.4,ctx.drawImage(this.image,48,0,16,16,8,8,64,64)),ctx.globalAlpha=this.alpha,this.animated?(this.animation.pauseAnimation||this.animation.getKeyFrame(t),ctx.drawImage(this.image,this.width*this.animation.currentFrame,0,this.width,this.height,0,0,this.width*this.scale,this.height*this.scale)):null==this.image||this.isButton?(ctx.fillStyle=this.colour,ctx.fillRect(.5*this.mhWidth*this.scale,.5*this.mhHeight*this.scale,.5*this.width*this.scale,.5*this.height*this.scale)):ctx.drawImage(this.image,this.sx,this.sy,this.width,this.height,this.hWidth,this.hHeight+this.yDrawOffset,this.width*this.scale,this.height*this.scale),this.isServer()&&this.ammo>0&&ctx.drawImage(this.image,128,32,this.width,this.height,this.hWidth,this.hHeight+this.yDrawOffset,this.width*this.scale,this.height*this.scale),this.showTextTime>0?(this.showTextTime-=t,gradient=ctx.createLinearGradient(0,0,U,0),gradient.addColorStop("0","#05f2db"),gradient.addColorStop(".1","#990099"),ctx.font="italic 700 25px Unknown Font, sans-serif",ctx.fillStyle=gradient,ctx.fillText(this.showText,0,this.showTextY+10*this.showTextTime)):this.currentGift=0,this.isButton&&(by=32,this.type==l.CHAIR?(this.hoverText="Chair",this.hoverText2="$"+ft,bx=48,Bt.menu.currentBuildItem==l.CHAIR&&ctx.drawImage(this.image,112,32,16,16,-32,-32,64,64)):this.type==l.DESK?(bx=58,this.hoverText="Desk",this.hoverText2="$"+xt,Bt.menu.currentBuildItem==l.DESK&&ctx.drawImage(this.image,112,32,16,16,-32,-32,64,64)):this.type==l.PC?(this.hoverText="PC",this.hoverText2="$"+mt,bx=68,Bt.menu.currentBuildItem==l.PC&&ctx.drawImage(this.image,112,32,16,16,-32,-32,64,64)):this.type==l.SERVER?(this.hoverText="Server",this.hoverText2="$"+gt,bx=78,Bt.menu.currentBuildItem==l.SERVER&&ctx.drawImage(this.image,112,32,16,16,-32,-32,64,64)):this.type==l.VEND?(bx=88,this.hoverText="Vending",this.hoverText2="$"+yt,Bt.menu.currentBuildItem==l.VEND&&ctx.drawImage(this.image,112,32,16,16,-32,-32,64,64)):this.type==l.GUN?(bx=98,this.hoverText="SELECT",this.hoverText2="DATA GUN",Bt.menu.currentBuildItem==l.GUN&&ctx.drawImage(this.image,112,32,16,16,-32,-32,64,64)):this.type==l.AUTO?(bx=48,by=42,this.hoverText="AUTO",this.hoverText2="$"+At,Bt.menu.currentBuildItem==l.AUTO&&ctx.drawImage(this.image,112,32,16,16,-32,-32,64,64)):this.type==l.UP?(bx=58,by=42,this.hoverText="Upgrade",this.hoverText="$"+It):(bx=115,by=36),ctx.drawImage(this.image,bx,by,10,10,-16,-16,32,32),this.hover&&(ctx.globalAlpha=.8,ctx.fillStyle="#990099",ctx.fillRect(-215,-50,167,100),ctx.fillStyle=this.colour,ctx.fillRect(-200,-32,165,64),ctx.globalAlpha=1,ctx.font="italic 700 25px Unknown Font, sans-serif",ctx.fillStyle="#990099",ctx.fillText(this.hoverText,-180,-5),ctx.fillText(this.hoverText2,-180,20))),this.isTable())ctx.globalAlpha=1,null!=this.pc&&this.pc.direction==c.PC_B?(ctx.translate(0,-30),ctx.drawImage(this.image,112,16,this.width,this.height,this.hWidth,this.hHeight,this.width*this.scale,this.height*this.scale)):null!=this.pc&&this.pc.direction==c.PC&&(ctx.translate(0,-20),ctx.drawImage(this.image,128,16,this.width,this.height,this.hWidth,this.hHeight,this.width*this.scale,this.height*this.scale));else if(this.isServer())this.time+=t,this.time>nt&&(this.time=0,0==this.ammo&&(this.ammo+=at,this.showTextY=-35,this.showTextTime=ct,this.showText="+"+at+" data - $"+ot,st-=ot));else if(this.isVend())this.time+=t,this.time>rt&&(this.time=0,amount=Bt.customers.userCount*ht,st+=amount,amount>0&&(this.showTextY=-35,this.showTextTime=ct,this.showText="+ $"+Bt.customers.userCount*ht));else if(this.isAuto())for(var i=Bt.customers.pcs,e=0;e<i.length;e++){if(pc=i[e],person=pc.getPerson(),null!=person&&person.progress.waiting&&this.shootTime<=0&&!Rt[pc.id]){this.shootTime=Lt,ox=this.x,oy=this.y,dx=pc.tile.entity.x,dy=pc.tile.entity.y,Bt.hero.gun.addBullets(ox,oy,dx,dy),Rt[pc.id]=!0;break}this.shootTime>0&&(this.shootTime-=t)}ctx.restore()}},this.flipMonitors=function(){null!=this.pc&&(this.pc.direction==c.PC?this.pc.direction=c.PC_B:this.pc.direction=c.PC)},this.isHero=function(){return this.type==c.HERO},this.isTable=function(){return this.type==c.TABLE},this.isChairB=function(){return this.type==c.CHAIR_B},this.isChairT=function(){return this.type==c.CHAIR_T},this.isFloor=function(){return this.type==c.FLOOR},this.isServer=function(){return this.type==c.SERVER},this.isVend=function(){return this.type==c.VEND},this.isAuto=function(){return this.type==c.AUTO},this.setType=function(){switch(this.alpha=1,this.sy=0,this.sx=0,this.yDrawOffset=0,this.hitboxOffsetY=0,this.isSolid=!0,this.type){case c.WALL_R:this.sx=80;break;case c.WALL_RT:this.sx=128;break;case c.WALL_LT:this.sx=16,this.sy=16;break;case c.WALL_L:this.sx=64;break;case c.WALL_T:this.sy=16;break;case c.WALL_B:this.sx=112;break;case c.WALL_BR:this.sx=32,this.sy=16;break;case c.WALL_BL:this.sx=48,this.sy=16;break;case c.FLOOR:this.sx=48,this.alpha=.4,this.isSolid=!1,this.drawTile=!1;break;case c.AIR:this.sx=144,this.isSolid=!1;break;case c.TABLE:this.sx=64,this.sy=16,this.drawTile=!0;break;case c.CHAIR_T:this.sx=80,this.sy=16,this.isSolid=!1,this.drawTile=!0;break;case c.CHAIR_B:this.sx=96,this.sy=16,this.isSolid=!1,this.drawTile=!0;break;case c.PC:this.sx=112,this.sy=16,this.isSolid=!1;break;case c.SERVER:this.sx=144,this.sy=16,this.yDrawOffset=-20,this.hitboxOffsetY=5,this.drawTile=!0;break;case c.VEND:this.sx=144,this.sy=32,this.yDrawOffset=-20,this.hitboxOffsetY=5,this.drawTile=!0;break;case c.AUTO:this.sx=128,this.sy=48,this.yDrawOffset=-20,this.hitboxOffsetY=5,this.drawTile=!0}}}function P(){xOffset=5,yOffset=5,this.scale=4,this.hero=new H(16,16,U/2,N/2,0,c.HERO,"",this.scale,xOffset,yOffset),this.hero.image.src="atlas.png",this.hero.sx=16,this.speed=5,this.level=new E(U,N,0),this.hero.currentLevel=0,this.hero.gun=new ri,this.level.reset(this.hero,this.scale),this.menu=new si(this.scale),this.customers=new hi,this.update=function(t,i){F=navigator.getGamepads(),Wt()&&(this.hero.x-=this.getMoveAmount(-this.speed,0)),_t()&&(this.hero.x+=this.getMoveAmount(this.speed,0)),Mt()&&(this.hero.y-=this.getMoveAmount(0,-this.speed)),Dt()&&(this.hero.y+=this.getMoveAmount(0,this.speed)),Ft()&&(this.menu.currentBuildItem=l.GUN),heroRow=Math.floor((this.hero.y-this.hero.mhHeightScaled)/64),heroCol=Math.floor((this.hero.x-this.hero.mhWidthScaled)/64),heroTileIndex=heroCol+19*heroRow,null!=this.currentTile&&(this.prevTile=this.currentTile),this.currentTile=this.level.tiles[heroTileIndex],this.currentTile!=this.prevTile&&(this.hero.collisionArray=[],heroTileIndex&&this.hero.collisionArray.push(this.level.tiles[heroTileIndex-1]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex+1]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex+18]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex+19]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex+20]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex-18]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex-19]),this.hero.collisionArray.push(this.level.tiles[heroTileIndex-20]));for(var e=0;e<this.hero.collisionArray.length;e++)tile=this.hero.collisionArray[e],tile.entity.isServer()&&L(tile.entity.hitbox,this.hero.sensor)&&tile.entity.ammo>0&&(this.hero.gun.ammo+=tile.entity.ammo,this.hero.showTextY=-15,this.hero.showTextTime=ct/2,this.hero.currentGift+=tile.entity.ammo,this.hero.showText="++ "+this.hero.currentGift+" data",tile.entity.ammo=0,tile.entity.time=0);C(i),this.level.tick(this.hero),this.customers.tick(t,this.level),this.level.draw(this.hero,t),this.customers.draw(t),gradient=ctx.createLinearGradient(0,0,U,0),gradient.addColorStop("0","#05f2db"),gradient.addColorStop(".5","#990099"),ctx.fillStyle=gradient,ctx.font="italic 700 40px Unknown Font, sans-serif",ctx.fillText("$: "+st,900,50),ctx.font="italic 700 25px Unknown Font, sans-serif",ctx.fillText("PCS: "+this.customers.pcs.length,30,50),ctx.fillText("Users: "+this.customers.userCount,180,50),ctx.fillText("Rating: "+bt+"%",360,50),ctx.fillText("Data: "+this.hero.gun.ammo,540,50),z&&(z=Bt.menu.tick()),this.menu.processBuilding(z,this.level,this.customers),z=!1,this.hero.update(t),this.hero.gun.drawBullets(t,this.customers.pcs),this.menu.update(),Ht.canvas.style.cursor="none";let s=K.x,h=K.y;Ht.context.globalCompositeOperation="difference",Ht.context.fillStyle="WHITE",Ht.context.fillRect(s-2,h-15,4,30),Ht.context.fillRect(s-15,h-2,30,4),Ht.context.globalCompositeOperation="source-over"},this.getMoveAmount=function(t,i){rec=v(this.hero.hitbox),rec.x+=t,rec.y+=i,amount=0;for(var e=1;e<this.speed;e++){canMove=!0;for(var s=0;s<this.hero.collisionArray.length;s++)if(tile=this.hero.collisionArray[s],tile.entity.isSolid&&L(tile.entity.hitbox,rec)){canMove=!1;break}canMove&&amount++}return amount}}var W,_,M,D=!1,F=[],U=1216,N=832,$=!1,G=0,Y=Date.now(),V=Date.now(),X=0,K=new k(0,0),q=new k(0,0),z=!1,J=1.346,Q=1.38,Z=-1,tt=0,it=0,et="100%",st=404,ht=3,nt=10,rt=10,ot=5,at=5,ct=2,lt=.4,ut=25,pt=20,dt=400,xt=100,ft=25,yt=1500,mt=150,gt=150,wt=80,vt=100,bt=75,Tt=5,At=0,Lt=3,kt=1,Ct=!1,It=1e3,Rt=[],Bt=new P;a();var St=!1,Ot=!1,Et=0;function startGame(){Ht.start()}var Ht={canvas:document.createElement("canvas"),start:function(){this.canvas.width=U,this.canvas.height=N,this.context=this.canvas.getContext("2d"),this.context.scale(1,1),this.context.mozImageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.context.imageSmoothingEnabled=!1,this.canvas.classList.add("screen"),document.body.insertBefore(this.canvas,document.body.childNodes[6]),this.frameNo=0,this.interval=setInterval(Pt,20),window.addEventListener("keydown",function(t){t.preventDefault(),Ht.keys=Ht.keys||[],Ht.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("keyup",function(t){Ht.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("mousedown",function(t){t.preventDefault(),Ht.keys=Ht.keys||[],Ht.keys[t.button]=!0}),window.addEventListener("mouseup",function(t){t.preventDefault(),Ht.keys=Ht.keys||[],Ht.keys[t.button]=!1,q.set(K.x,K.y),_=Math.floor(q.y/64),M=Math.floor(q.x/64),W=M+19*_,z=!0,St||Ot||(St=!0)}),window.addEventListener("mousemove",function(t){t.preventDefault();var i=Ht.canvas.getBoundingClientRect();K.set((t.clientX-i.left)*J,(t.clientY-i.top)*Q)}),this.canvas.oncontextmenu=function(t){t.preventDefault()},window.addEventListener("gamepadconnected",function(t){var i=navigator.getGamepads()[t.gamepad.index];console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",i.index,i.id,i.buttons.length,i.axes.length)})},stop:function(){clearInterval(this.interval)},clear:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}};function Pt(){St&&h?(e.play(),St=!1,Et=0):(Et+=G)>48e3&&(e.currentTime=0,e.play(),Et=0),Y=V,V=Date.now(),X+=G=V-Y,navigator.getGamepads?navigator.getGamepads():!navigator.webkitGetGamepads||navigator.webkitGetGamepads,$?Ht.clear():(Ht.clear(),Bt.update(G/1e3,X))}function Wt(){return Ht.keys&&(Ht.keys[Ut]||Ht.keys[Yt])}function _t(){return Ht.keys&&(Ht.keys[Nt]||Ht.keys[Xt])}function Mt(){return Ht.keys&&(Ht.keys[It]||Ht.keys[Gt])}function Dt(){return Ht.keys&&(Ht.keys[$t]||Ht.keys[Vt])}function Ft(){return Ht.keys&&Ht.keys[qt]}var Ut=37,Nt=39,$t=(It=38,40),Gt=87,Yt=65,Vt=83,Xt=68,jt=0,Kt=2,qt=32,zt=49,Jt=50,Qt=51,Zt=52;function ti(t){this.scale=4,this.entity=new H(16,16,t.entity.x,t.entity.y,0,c.PERSON,"blue",this.scale,0,0,"atlas.png"),this.requestTime=0,this.useTime=0,this.hasTarget=!1,this.progress=new ni,this.parent=t.entity,this.tile=t,t.entity.type==c.CHAIR_B?(this.entity.sx=32,this.entity.sy=32):t.entity.type==c.CHAIR_T&&(this.entity.sx=16,this.entity.sy=32,this.entity.y-=40),this.tick=function(){this.entity.update(),this.progress.draw(this.entity.x,this.entity.y,this.entity),this.progress.tick(G),this.progress.fourfour||this.progress.delivered?(Rt[this.tile.pc.id]=!1,this.parent.type==c.CHAIR_B?this.parent.showTextY=-25:this.parent.showTextY=-70,this.parent.showText=this.progress.fourfour?"Status: 404":"Status: 200",this.parent.showTextTime=ct,this.progress.fourfour=!1,this.progress.delivered=!1):this.progress.percent>.75&&Rt[this.tile.pc.id]&&(Rt[this.tile.pc.id]=!1)}}function ii(t,i,e){Z++,this.id=Z,this.inUse=!1,this.direction=t,this.chair=i,this.chair.pc=this,this.tile=e,this.hitbox=new f(e.entity.x+30,e.entity.y+10,20,20),this.getPerson=function(){return this.chair.entity.person},this.rmPerson=function(){return this.chair.entity.person=null}}function ei(t,i,e,s,h,n){this.entity=new H(t,i,e,s,0,n,h,4,hitboxOffsetX=0,hitboxOffsetY=0,"atlas.png",!0),this.action=n,this.update=function(){this.entity.update()},this.tick=function(t){},this.processAction=function(){Bt.menu.currentBuildItem=this.action}}function si(e){for(this.scale=e,this.menu=new H(48,N,U-48,N/2,0,c.BOX,"#cc00cc",this.scale,0,0),this.menu.image=null,this.menu.alpha=.4,this.buttons=[],this.currentBuildItem=null,this.nButtons=10,i=0;i<this.nButtons;i++)this.buttons.push(new ei(32,32,U-48,50+80*i,"#131a2d",I(l,i)));this.update=function(){for(this.menu.update(),i=0;i<this.nButtons;i++)b=this.buttons[i],b.update(),A(K.x,K.y,32,32,b.entity.x,b.entity.y,b.entity.width,b.entity.height)?b.entity.hover=!0:b.entity.hover=!1},this.tick=function(){clickRec=new T(q,10,10);for(var t=0;t<this.buttons.length;t++)if(b=this.buttons[t],L(b.entity.hitbox,clickRec))return b.processAction(),!1;return!0},this.processBuilding=function(i,e,s){if(i&&(i=!1,ci=W,t=m(ci,e),null!=t)){switch(ta=m(ci-19,e),taa=m(ci-38,e),tb=m(ci+19,e),tbb=m(ci+38,e),this.currentBuildItem){case l.CHAIR:if(t.isChairB()){ta.isTable()&&!taa.isChairB()&&(t.entity.type=c.CHAIR_T,null!=tb.entity.pc&&(t.entity.person=null,s.removePC(tb.entity.pc),tb.entity.pc=null));break}if(t.isChairT()){tb.isTable()&&!tbb.isChairT()&&(t.entity.type=c.CHAIR_B,null!=ta.entity.pc&&(t.entity.person=null,s.removePC(ta.entity.pc),ta.entity.pc=null));break}tb.isTable()?tbb.isChairT()?(tbb.entity.type=c.FLOOR,t.entity.person=null,tbb.entity.person=null,null!=tb.entity.pc&&(tb.entity.pc.chair=t),tbb.change(),tb.entity.flipMonitors(),t.entity.type=c.CHAIR_B):st>ft?(t.entity.type=c.CHAIR_B,st-=ft,d("- $"+ft)):d("Not enough $"):ta.isTable()&&(taa.isChairB()?(taa.entity.type=c.FLOOR,t.entity.person=null,taa.entity.person=null,null!=ta.entity.pc&&(ta.entity.pc.chair=t),taa.change(),ta.entity.flipMonitors(),t.entity.type=c.CHAIR_T):st>ft?(t.entity.type=c.CHAIR_T,st-=ft,d("- $"+ft)):d("Not enough $"));break;case l.DESK:t.isFloor()&&(st>xt?(st-=xt,d("- $"+xt),t.entity.type=c.TABLE):d("Not enough $"));break;case l.PC:t.isTable()&&(st>mt?(st-=mt,d("- $"+mt),ta.isChairB()?(t.entity.addPC(c.PC,ta,t),s.addPC(t.entity.pc)):tb.isChairT()&&(t.entity.addPC(c.PC_B,tb,t),s.addPC(t.entity.pc))):d("Not enough $")),t.change();break;case l.VEND:st>yt?t.isFloor()&&(t.entity.type=c.VEND,st-=yt,d("- $"+yt)):d("Not enough $");break;case l.SERVER:st>gt?t.isFloor()&&(t.entity.type=c.SERVER,st-=gt,d("- $"+gt)):d("Not enough $");break;case l.GUN:ox=Bt.hero.x-Bt.hero.mhWidthScaled,oy=Bt.hero.y-Bt.hero.mhHeightScaled,dx=q.x,dy=q.y,Bt.hero.gun.addBullets(ox,oy,dx,dy);break;case l.AUTO:t.isFloor()&&(t.entity.type=c.AUTO,st-=At,d("- $"+At));break;default:console.log("NaN")}t.change()}}}function hi(){this.customerList=[],this.pcs=[],this.time=0,this.eventTime=3,this.maxPChance=100,this.userCount=0,this.tick=function(t){if(this.time+=t,this.time>this.eventTime)for(this.time=0,i=0;i<this.pcs.length;i++)pc=this.pcs[i],null!=pc&&null==pc.chair.person()?g(0,100)<bt&&(pc.chair.entity.person=new ti(pc.chair),this.userCount++):null!=pc.getPerson()&&(pc.getPerson().progress.reset(),pc.getPerson().progress.exit&&(pc.rmPerson(),this.userCount--,st-=pt,Bt.hero.showTextY=-5,Bt.hero.showTextTime=2*lt,Bt.hero.showText="- S"+pt,(bt-=Tt)<=0&&(Ct=!0)))},this.draw=function(t){for(i=0;i<this.pcs.length;i++)pc=this.pcs[i],null!=pc&&null!=pc.chair.person()&&pc.chair.person().hasTarget&&pc.chair.person().entity.update(t)},this.removePC=function(t){this.pcs[t.id]=null,this.pcs=this.pcs.filter(function(t,i,e){return null!=t})},this.addPC=function(t){this.pcs[t.id]=t}}function ni(){function t(t){return t>=1}this.percent=0,this.startAngle=1.5*Math.PI,this.endAngle=-.5*Math.PI+this.percent*Math.PI*2,this.colour1="silver",this.colour2=w(),this.resetChance=wt,this.happy=g(2,5),this.mHappy=!0,this.speed=8e3,this.minSpeed=8e3,this.maxSpeed=3e3,this.exit=!1,this.fourfour=!1,this.delivered=!1,this.waiting=!1,this.draw=function(i,e){ctx=Ht.context,this.endAngle=-.5*Math.PI+this.percent*Math.PI*2,ctx.lineWidth=10,t(this.percent)?(this.waiting=!1,this.mHappy&&!this.delivered&&(this.fourfour=!0,this.happy--,this.mHappy=!1,0==this.happy&&(this.exit=!0))):(this.waiting=!0,this.mHappy=!0,ctx.beginPath(),ctx.arc(i,e,10,this.startAngle,this.endAngle),ctx.strokeStyle=this.colour1,ctx.stroke(),ctx.beginPath(),ctx.arc(i,e,10,this.endAngle,-.5*Math.PI),ctx.strokeStyle=this.colour2,ctx.stroke(),ctx.restore())},this.tick=function(i){t(this.percent)||(this.percent+=i/this.speed)},this.reset=function(){t(this.percent)&&this.resetChance>g(0,100)&&(this.percent=0,this.speed=g(this.maxSpeed,this.minSpeed))}}function ri(){this.ammo=vt,this.bullets=[],this.addBullets=function(t,i,e,s){this.ammo>0&&(this.bullets.push(new oi(t,i,e,s)),this.ammo--)},this.drawBullets=function(t,e){for(i=0;i<this.bullets.length;i++){this.bullets[i].draw(t,e)}this.bullets=this.bullets.filter(function(t){return 1==t.active})}}function oi(t,i,e,s){this.id=tt++,this.scale=4,this.speed=3,this.v=new k(t+10,i+10),this.dx=e-t,this.dy=s-i,this.w=50,this.h=50,this.mhWidth=this.w/-2,this.mhHeight=this.h/-2,this.dst=0,this.active=!0,this.hitbox=new f(t,i,this.w,this.h),this.colour="#a205a2",this.dist=0,this.draw=function(t,i){if(this.active){var e=this.v.x,s=this.v.x;this.v.x+=this.dx*t*this.speed,this.v.y+=this.dy*t*this.speed;var h=e-this.v.x,n=s-this.v.x,r=Math.sqrt(h*h+n*n);for(this.dist+=r,(this.v.x<0||this.v.x>1300||this.v.y<0||this.v.y>840||this.dist>dt)&&(this.active=!1),this.hitbox.x=this.v.x+this.mhWidth,this.hitbox.y=this.v.y+this.mhHeight,j=0;j<i.length;j++)pc=i[j],person=pc.getPerson(),null!=person&&L(pc.hitbox,this.hitbox)&&null!=person.progress&&person.progress.percent<1&&(person.progress.percent=1,person.progress.happy<5&&(person.progress.happy+=2),person.progress.delivered=!0,person.progress.mHappy=!1,st+=ut,Rt[pc.id]=!1,this.active=!1,Bt.hero.showTextY=-5,Bt.hero.showTextTime=lt,Bt.hero.showText="+ S"+ut);ctx=Ht.context,ctx.save(),ctx.translate(this.v.x,this.v.y),ctx.fillStyle=this.colour,ctx.fillRect(.5*this.mhWidth,.5*this.mhHeight,.5*this.w,.5*this.h),ctx.restore()}}}